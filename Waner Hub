-- Waner Hub v3.0 | Complete with Debug
print("=== WANER HUB STARTING ===")
print("Step 1: Initializing...")

-- Loading Screen
local function createLoadingScreen()
    print("Step 2: Creating loading screen...")
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "WanerLoading"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = game.CoreGui
    
    local Blur = Instance.new("BlurEffect")
    Blur.Size = 0
    Blur.Parent = game.Lighting
    
    local Background = Instance.new("Frame")
    Background.Size = UDim2.new(1, 0, 1, 0)
    Background.BackgroundColor3 = Color3.fromRGB(10, 10, 15)
    Background.BackgroundTransparency = 1
    Background.Parent = ScreenGui
    
    local Container = Instance.new("Frame")
    Container.Size = UDim2.new(0, 450, 0, 220)
    Container.Position = UDim2.new(0.5, -225, 0.5, -110)
    Container.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
    Container.BackgroundTransparency = 1
    Container.Parent = ScreenGui
    
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 15)
    Corner.Parent = Container
    
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, 0, 0, 60)
    Title.Position = UDim2.new(0, 0, 0, 30)
    Title.BackgroundTransparency = 1
    Title.Text = "WANER HUB"
    Title.TextColor3 = Color3.fromRGB(139, 0, 255)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 42
    Title.TextTransparency = 1
    Title.Parent = Container
    
    local Status = Instance.new("TextLabel")
    Status.Size = UDim2.new(1, 0, 0, 30)
    Status.Position = UDim2.new(0, 0, 0, 100)
    Status.BackgroundTransparency = 1
    Status.Text = "Loading..."
    Status.TextColor3 = Color3.fromRGB(200, 200, 200)
    Status.Font = Enum.Font.Gotham
    Status.TextSize = 18
    Status.TextTransparency = 1
    Status.Parent = Container
    
    local Progress = Instance.new("Frame")
    Progress.Size = UDim2.new(0.8, 0, 0, 6)
    Progress.Position = UDim2.new(0.1, 0, 0, 150)
    Progress.BackgroundColor3 = Color3.fromRGB(139, 0, 255)
    Progress.BorderSizePixel = 0
    Progress.Parent = Container
    
    local ProgressCorner = Instance.new("UICorner")
    ProgressCorner.CornerRadius = UDim.new(1, 0)
    ProgressCorner.Parent = Progress
    
    local TweenService = game:GetService("TweenService")
    
    task.spawn(function()
        TweenService:Create(Blur, TweenInfo.new(0.5), {Size = 20}):Play()
        TweenService:Create(Background, TweenInfo.new(0.5), {BackgroundTransparency = 0.3}):Play()
        TweenService:Create(Container, TweenInfo.new(0.5), {BackgroundTransparency = 0.1}):Play()
        wait(0.5)
        TweenService:Create(Title, TweenInfo.new(0.3), {TextTransparency = 0}):Play()
        TweenService:Create(Status, TweenInfo.new(0.3), {TextTransparency = 0}):Play()
        wait(0.5)
        
        for i = 1, 3 do
            Status.Text = "Loading" .. string.rep(".", i)
            TweenService:Create(Progress, TweenInfo.new(0.8), {Size = UDim2.new(0.8 * (i/3), 0, 0, 6)}):Play()
            wait(0.8)
        end
        
        Status.Text = "Complete!"
        wait(0.5)
        
        TweenService:Create(Title, TweenInfo.new(0.4), {TextTransparency = 1}):Play()
        TweenService:Create(Status, TweenInfo.new(0.4), {TextTransparency = 1}):Play()
        TweenService:Create(Container, TweenInfo.new(0.4), {BackgroundTransparency = 1}):Play()
        TweenService:Create(Background, TweenInfo.new(0.4), {BackgroundTransparency = 1}):Play()
        TweenService:Create(Blur, TweenInfo.new(0.5), {Size = 0}):Play()
        wait(0.6)
        
        Blur:Destroy()
        ScreenGui:Destroy()
    end)
    print("Step 2: Loading screen created!")
end

pcall(createLoadingScreen)
wait(4)

print("Step 3: Loading complete, starting key system...")

-- Key System
local KeySystemEnabled = true
local CorrectKey = "Wene-you"
local KeyExpireHours = 8

local function checkKey()
    local HttpService = game:GetService("HttpService")
    local success, data = pcall(function()
        return HttpService:JSONDecode(readfile("WanerHubKey.json"))
    end)
    if success and data then
        local currentTime = os.time()
        local savedTime = data.time or 0
        local timeDiff = (currentTime - savedTime) / 3600
        if timeDiff < KeyExpireHours and data.key == CorrectKey then
            return true, KeyExpireHours - timeDiff
        end
    end
    return false, 0
end

local function saveKey()
    local HttpService = game:GetService("HttpService")
    writefile("WanerHubKey.json", HttpService:JSONEncode({key = CorrectKey, time = os.time()}))
end

local function createKeyUI()
    print("Step 4: Creating key UI...")
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "WanerKeySystem"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = game.CoreGui
    
    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 400, 0, 250)
    MainFrame.Position = UDim2.new(0.5, -200, 0.5, -125)
    MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    MainFrame.BorderSizePixel = 0
    MainFrame.Parent = ScreenGui
    
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 12)
    Corner.Parent = MainFrame
    
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, 0, 0, 50)
    Title.BackgroundColor3 = Color3.fromRGB(139, 0, 255)
    Title.Text = "üîê Waner Hub Key"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 20
    Title.Parent = MainFrame
    
    local TitleCorner = Instance.new("UICorner")
    TitleCorner.CornerRadius = UDim.new(0, 12)
    TitleCorner.Parent = Title
    
    local Desc = Instance.new("TextLabel")
    Desc.Size = UDim2.new(1, -40, 0, 60)
    Desc.Position = UDim2.new(0, 20, 0, 60)
    Desc.BackgroundTransparency = 1
    Desc.Text = "Masukkan key untuk akses\n\nüí° Clue: Wene-***"
    Desc.TextColor3 = Color3.fromRGB(200, 200, 200)
    Desc.Font = Enum.Font.Gotham
    Desc.TextSize = 14
    Desc.TextWrapped = true
    Desc.TextYAlignment = Enum.TextYAlignment.Top
    Desc.Parent = MainFrame
    
    local KeyInput = Instance.new("TextBox")
    KeyInput.Size = UDim2.new(1, -40, 0, 40)
    KeyInput.Position = UDim2.new(0, 20, 0, 130)
    KeyInput.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
    KeyInput.PlaceholderText = "Enter Key..."
    KeyInput.Text = ""
    KeyInput.TextColor3 = Color3.fromRGB(255, 255, 255)
    KeyInput.Font = Enum.Font.Gotham
    KeyInput.TextSize = 16
    KeyInput.Parent = MainFrame
    
    local InputCorner = Instance.new("UICorner")
    InputCorner.CornerRadius = UDim.new(0, 8)
    InputCorner.Parent = KeyInput
    
    local Padding = Instance.new("UIPadding")
    Padding.PaddingLeft = UDim.new(0, 10)
    Padding.Parent = KeyInput
    
    local SubmitBtn = Instance.new("TextButton")
    SubmitBtn.Size = UDim2.new(1, -40, 0, 40)
    SubmitBtn.Position = UDim2.new(0, 20, 0, 180)
    SubmitBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
    SubmitBtn.Text = "‚úì Submit"
    SubmitBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    SubmitBtn.Font = Enum.Font.GothamBold
    SubmitBtn.TextSize = 16
    SubmitBtn.Parent = MainFrame
    
    local BtnCorner = Instance.new("UICorner")
    BtnCorner.CornerRadius = UDim.new(0, 8)
    BtnCorner.Parent = SubmitBtn
    
    local Status = Instance.new("TextLabel")
    Status.Size = UDim2.new(1, -40, 0, 20)
    Status.Position = UDim2.new(0, 20, 0, 225)
    Status.BackgroundTransparency = 1
    Status.Text = ""
    Status.TextColor3 = Color3.fromRGB(255, 100, 100)
    Status.Font = Enum.Font.Gotham
    Status.TextSize = 12
    Status.Parent = MainFrame
    
    return ScreenGui, KeyInput, SubmitBtn, Status
end

local player = game.Players.LocalPlayer
local ownerUsername = "winnertupiq52"
local isOwner = player.Name == ownerUsername

print("Step 5: Checking key...")
local keyValid, timeLeft = checkKey()

if KeySystemEnabled and not keyValid then
    print("Step 6: Key required, showing key UI...")
    local gui, input, button, status = createKeyUI()
    local submitted = false
    
    button.MouseButton1Click:Connect(function()
        if submitted then return end
        print("Key submitted:", input.Text)
        if input.Text == CorrectKey then
            print("Key correct!")
            status.Text = "‚úì Your key correct!"
            status.TextColor3 = Color3.fromRGB(100, 255, 100)
            saveKey()
            submitted = true
            wait(1.5)
            gui:Destroy()
        else
            print("Wrong key!")
            status.Text = "‚úó Wrong Key!"
            status.TextColor3 = Color3.fromRGB(255, 100, 100)
            input.Text = ""
        end
    end)
    
    repeat wait(0.1) until submitted
    print("Step 7: Key accepted!")
else
    print("Step 6: Key valid, skipping key UI...")
end

-- Welcome Screen
local function createWelcome()
    print("Step 8: Creating welcome screen...")
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "WanerWelcome"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = game.CoreGui
    
    local Frame = Instance.new("Frame")
    Frame.Size = UDim2.new(0, 450, 0, 140)
    Frame.Position = UDim2.new(0.5, -225, 0.5, -70)
    Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
    Frame.BorderSizePixel = 0
    Frame.Parent = ScreenGui
    
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 12)
    Corner.Parent = Frame
    
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, 0, 0, 50)
    Title.Position = UDim2.new(0, 0, 0, 20)
    Title.BackgroundTransparency = 1
    Title.Text = isOwner and "üëë WELCOME OWNER" or "‚ú® WELCOME"
    Title.TextColor3 = isOwner and Color3.fromRGB(255, 215, 0) or Color3.fromRGB(139, 0, 255)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 32
    Title.Parent = Frame
    
    local Name = Instance.new("TextLabel")
    Name.Size = UDim2.new(1, 0, 0, 35)
    Name.Position = UDim2.new(0, 0, 0, 75)
    Name.BackgroundTransparency = 1
    Name.Text = player.DisplayName
    Name.TextColor3 = Color3.fromRGB(200, 200, 200)
    Name.Font = Enum.Font.Gotham
    Name.TextSize = 22
    Name.Parent = Frame
    
    task.delay(3, function()
        ScreenGui:Destroy()
    end)
end

pcall(createWelcome)
wait(3.5)

-- Animated Text Screen
local function createAnimatedText()
    print("Step 9a: Creating animated text screen...")
    
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "WanerAnimation"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = game.CoreGui
    
    -- Black blur background
    local Background = Instance.new("Frame")
    Background.Size = UDim2.new(1, 0, 1, 0)
    Background.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    Background.BackgroundTransparency = 1
    Background.BorderSizePixel = 0
    Background.Parent = ScreenGui
    
    local Blur = Instance.new("BlurEffect")
    Blur.Size = 0
    Blur.Parent = game.Lighting
    
    -- Container for text
    local Container = Instance.new("Frame")
    Container.Size = UDim2.new(0, 600, 0, 200)
    Container.Position = UDim2.new(0.5, -300, 0.5, -100)
    Container.BackgroundTransparency = 1
    Container.Parent = ScreenGui
    
    -- Create scrambled letters
    local letters = {}
    local finalText = "WANER HUB"
    local scrambledPositions = {}
    
    -- Generate random positions for scrambled letters
    for i = 1, #finalText do
        local char = finalText:sub(i, i)
        if char ~= " " then
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(0, 60, 0, 80)
            label.Position = UDim2.new(
                math.random(0, 100) / 100,
                math.random(-200, 200),
                math.random(0, 100) / 100,
                math.random(-200, 200)
            )
            label.BackgroundTransparency = 1
            label.Text = char
            label.TextColor3 = Color3.fromRGB(139, 0, 255)
            label.Font = Enum.Font.GothamBold
            label.TextSize = 60
            label.TextTransparency = 1
            label.Rotation = math.random(-180, 180)
            label.Parent = Container
            
            table.insert(letters, {
                label = label,
                finalPos = UDim2.new(0, (i - 1) * 60 - (#finalText * 30), 0.5, -40),
                finalRot = 0
            })
        end
    end
    
    local TweenService = game:GetService("TweenService")
    
    task.spawn(function()
        -- Fade in background and blur
        TweenService:Create(Background, TweenInfo.new(0.5), {BackgroundTransparency = 0.3}):Play()
        TweenService:Create(Blur, TweenInfo.new(0.5), {Size = 20}):Play()
        wait(0.5)
        
        -- Show scrambled letters
        for _, data in pairs(letters) do
            TweenService:Create(data.label, TweenInfo.new(0.3), {TextTransparency = 0}):Play()
        end
        wait(0.8)
        
        -- Animate letters to correct positions
        for _, data in pairs(letters) do
            TweenService:Create(data.label, TweenInfo.new(1, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
                Position = data.finalPos,
                Rotation = data.finalRot
            }):Play()
        end
        wait(1.5)
        
        -- Fade out
        for _, data in pairs(letters) do
            TweenService:Create(data.label, TweenInfo.new(0.5), {TextTransparency = 1}):Play()
        end
        TweenService:Create(Background, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
        TweenService:Create(Blur, TweenInfo.new(0.5), {Size = 0}):Play()
        wait(0.6)
        
        Blur:Destroy()
        ScreenGui:Destroy()
    end)
    
    wait(4)
end

pcall(createAnimatedText)

print("Step 9: Loading Obsidian UI...")

-- Load Obsidian UI
local Obsidian = loadstring(game:HttpGet('https://raw.githubusercontent.com/1201for/V.G-Hub/main/im-retarded-3.lua'))()
print("Step 10: Obsidian loaded!")

local Window = Obsidian:CreateWindow({
    Name = "Waner Hub",
    LoadingTitle = "Waner Hub",
    LoadingSubtitle = "by Waner",
    ConfigurationSaving = {
        Enabled = false,
        FolderName = nil,
        FileName = "WanerHub"
    },
    Discord = {
        Enabled = false,
        Invite = "noinvitelink",
        RememberJoins = true
    },
    KeySystem = false,
    KeySettings = {
        Title = "Waner Hub",
        Subtitle = "Key System",
        Note = "Key: Wene-you",
        FileName = "WanerKey",
        SaveKey = true,
        GrabKeyFromSite = false,
        Key = {"Wene-you"}
    }
})

print("Step 11: Window created!")

-- ESP Storage
local espObjects = {}
local keyEspObjects = {}
local entityEspObjects = {}
local playerEspObjects = {}
local bookEspObjects = {}
local codeEspObjects = {}
local leverEspObjects = {}
local itemEspObjects = {}

-- States
local doorEspEnabled = false
local keyEspEnabled = false
local entityEspEnabled = false
local playerEspEnabled = false
local figureEspEnabled = false
local leverEspEnabled = false
local itemEspEnabled = false
local rushNotifEnabled = false
local infVitaminsEnabled = false
local autoUnlockEnabled = false
local autoFigureEnabled = false
local autoCollectEnabled = false
local currentSpeed = 1
local vitaminConnections = {}

print("Step 12: Variables initialized!")

-- Anti-Detect Speed
local oldSpeed = 16
local function setSpeed(multiplier)
    currentSpeed = multiplier
    if player.Character and player.Character:FindFirstChild("Humanoid") then
        local hum = player.Character.Humanoid
        local targetSpeed = 16 * multiplier
        local steps = 10
        for i = 1, steps do
            local progress = i / steps
            hum.WalkSpeed = oldSpeed + (targetSpeed - oldSpeed) * progress
            wait(0.05)
        end
        oldSpeed = targetSpeed
    end
end

player.CharacterAdded:Connect(function(char)
    wait(0.5)
    if char:FindFirstChild("Humanoid") then
        setSpeed(currentSpeed)
    end
end)

-- ESP Function
local function createESP(obj, color, txt)
    if not obj or obj:FindFirstChild("ESP") then return nil end
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "ESP"
    billboard.Adornee = obj
    billboard.Size = UDim2.new(0, 100, 0, 50)
    billboard.StudsOffset = Vector3.new(0, 2, 0)
    billboard.AlwaysOnTop = true
    billboard.Parent = obj
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = txt
    label.TextColor3 = color
    label.TextStrokeTransparency = 0.5
    label.TextScaled = true
    label.Font = Enum.Font.SourceSansBold
    label.Parent = billboard
    
    return billboard
end

print("Step 13: ESP functions loaded!")

-- Door ESP with Auto-Refresh + Dupe Detection
local doorConnection
local function addDoorESP()
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("Model") and v.Name == "Door" and not v:FindFirstChild("ESP") then
            local part = v.PrimaryPart or v:FindFirstChildWhichIsA("BasePart")
            if part then
                local isDupe = false
                local doorNum = nil
                for _, desc in pairs(v:GetDescendants()) do
                    if desc:IsA("SurfaceGui") then
                        local label = desc:FindFirstChild("Number")
                        if label and label:IsA("TextLabel") then
                            doorNum = tonumber(label.Text)
                            break
                        end
                    end
                end
                
                if doorNum then
                    local gameData = game:GetService("ReplicatedStorage"):FindFirstChild("GameData")
                    if gameData then
                        local latest = gameData:FindFirstChild("LatestRoom")
                        if latest and doorNum ~= (latest.Value + 1) then
                            isDupe = true
                        end
                    end
                end
                
                local color = isDupe and Color3.fromRGB(255, 0, 0) or Color3.fromRGB(0, 255, 0)
                local text = isDupe and "‚ùå FAKE " .. (doorNum or "") or "üö™ Door"
                local esp = createESP(part, color, text)
                if esp then table.insert(espObjects, esp) end
            end
        end
    end
end

local function removeDoorESP()
    for _, esp in pairs(espObjects) do pcall(function() esp:Destroy() end) end
    espObjects = {}
end

local function enableDoorESP()
    doorEspEnabled = true
    addDoorESP()
    if doorConnection then doorConnection:Disconnect() end
    doorConnection = workspace.DescendantAdded:Connect(function(v)
        if doorEspEnabled and v:IsA("Model") and v.Name == "Door" then
            wait(0.5)
            addDoorESP()
        end
    end)
end

local function disableDoorESP()
    doorEspEnabled = false
    if doorConnection then doorConnection:Disconnect() end
    removeDoorESP()
end

-- Key ESP with Auto-Refresh
local keyConnection
local function addKeyESP()
    for _, v in pairs(workspace:GetDescendants()) do
        if v.Name == "Key" and not v:FindFirstChild("ESP") then
            local part = v:IsA("Model") and (v.PrimaryPart or v:FindFirstChildWhichIsA("BasePart")) or v
            if part then
                local esp = createESP(part, Color3.fromRGB(255, 255, 0), "üîë Key")
                if esp then table.insert(keyEspObjects, esp) end
            end
        end
    end
end

local function removeKeyESP()
    for _, esp in pairs(keyEspObjects) do pcall(function() esp:Destroy() end) end
    keyEspObjects = {}
end

local function enableKeyESP()
    keyEspEnabled = true
    addKeyESP()
    if keyConnection then keyConnection:Disconnect() end
    keyConnection = workspace.DescendantAdded:Connect(function(v)
        if keyEspEnabled and v.Name == "Key" then
            wait(0.2)
            addKeyESP()
        end
    end)
end

local function disableKeyESP()
    keyEspEnabled = false
    if keyConnection then keyConnection:Disconnect() end
    removeKeyESP()
end

-- Entity ESP (All Entities) with Auto-Refresh
local entityConnection
local function addEntityESP()
    local entities = {"RushMoving", "AmbushMoving", "Eyes", "Screech", "Halt", "Seek", "Figure", "BackdoorLookman", "A60", "A90"}
    for _, v in pairs(workspace:GetChildren()) do
        for _, entityName in pairs(entities) do
            if v.Name:find(entityName) and not v:FindFirstChild("ESP") then
                local part = v:FindFirstChildWhichIsA("BasePart", true)
                if part then
                    local displayName = v.Name:gsub("Moving", ""):upper()
                    local esp = createESP(part, Color3.fromRGB(255, 0, 0), "‚ö†Ô∏è " .. displayName)
                    if esp then table.insert(entityEspObjects, esp) end
                end
            end
        end
    end
end

local function removeEntityESP()
    for _, esp in pairs(entityEspObjects) do pcall(function() esp:Destroy() end) end
    entityEspObjects = {}
end

local function enableEntityESP()
    entityEspEnabled = true
    addEntityESP()
    if entityConnection then entityConnection:Disconnect() end
    entityConnection = workspace.ChildAdded:Connect(function(v)
        if entityEspEnabled then
            wait(0.1)
            addEntityESP()
        end
    end)
end

local function disableEntityESP()
    entityEspEnabled = false
    if entityConnection then entityConnection:Disconnect() end
    removeEntityESP()
end

-- Player ESP
local playerConnection
local function addPlayerESP()
    for _, plr in pairs(game.Players:GetPlayers()) do
        if plr ~= player and plr.Character then
            local hrp = plr.Character:FindFirstChild("HumanoidRootPart")
            if hrp and not hrp:FindFirstChild("ESP") then
                local esp = createESP(hrp, Color3.fromRGB(0, 150, 255), "üë§ " .. plr.Name)
                if esp then table.insert(playerEspObjects, esp) end
            end
        end
    end
end

local function removePlayerESP()
    for _, esp in pairs(playerEspObjects) do pcall(function() esp:Destroy() end) end
    playerEspObjects = {}
end

local function enablePlayerESP()
    playerEspEnabled = true
    addPlayerESP()
    if playerConnection then playerConnection:Disconnect() end
    playerConnection = game.Players.PlayerAdded:Connect(function()
        if playerEspEnabled then
            wait(1)
            addPlayerESP()
        end
    end)
end

local function disablePlayerESP()
    playerEspEnabled = false
    if playerConnection then playerConnection:Disconnect() end
    removePlayerESP()
end

-- Figure ESP with Auto-Refresh
local figureConnection
local collectedCode = {}

local function addFigureESP()
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("Model") and v.Name == "Book" then
            local isCorrect = false
            for _, child in pairs(v:GetDescendants()) do
                if (child:IsA("Decal") or child:IsA("Texture")) and child.Texture then
                    if child.Texture:lower():find("libraryhintpaper") then
                        isCorrect = true
                        break
                    end
                end
            end
            if isCorrect and not v:FindFirstChild("ESP") then
                local part = v.PrimaryPart or v:FindFirstChildWhichIsA("BasePart")
                if part then
                    local esp = createESP(part, Color3.fromRGB(150, 0, 255), "üìñ BOOK")
                    if esp then table.insert(bookEspObjects, esp) end
                end
            end
        end
        if v:IsA("Model") and v.Name == "Paper" and not v:FindFirstChild("ESP") then
            local part = v.PrimaryPart or v:FindFirstChildWhichIsA("BasePart")
            if part then
                local esp = createESP(part, Color3.fromRGB(0, 255, 255), "üî¢ CODE")
                if esp then table.insert(codeEspObjects, esp) end
            end
        end
    end
end

local function removeFigureESP()
    for _, esp in pairs(bookEspObjects) do pcall(function() esp:Destroy() end) end
    for _, esp in pairs(codeEspObjects) do pcall(function() esp:Destroy() end) end
    bookEspObjects = {}
    codeEspObjects = {}
end

local function enableFigureESP()
    figureEspEnabled = true
    addFigureESP()
    if figureConnection then figureConnection:Disconnect() end
    figureConnection = workspace.DescendantAdded:Connect(function(v)
        if figureEspEnabled and v:IsA("Model") and (v.Name == "Book" or v.Name == "Paper") then
            wait(0.3)
            addFigureESP()
        end
    end)
end

local function disableFigureESP()
    figureEspEnabled = false
    if figureConnection then figureConnection:Disconnect() end
    removeFigureESP()
end

-- Lever ESP
local leverEspObjects = {}
local leverEspEnabled = false
local leverConnection

local function addLeverESP()
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("Model") and (v.Name == "LeverForGate" or v.Name:lower():find("lever")) and not v:FindFirstChild("ESP") then
            local part = v.PrimaryPart or v:FindFirstChildWhichIsA("BasePart")
            if part then
                local esp = createESP(part, Color3.fromRGB(255, 165, 0), "üîß LEVER")
                if esp then table.insert(leverEspObjects, esp) end
            end
        end
    end
end

local function removeLeverESP()
    for _, esp in pairs(leverEspObjects) do pcall(function() esp:Destroy() end) end
    leverEspObjects = {}
end

local function enableLeverESP()
    leverEspEnabled = true
    addLeverESP()
    if leverConnection then leverConnection:Disconnect() end
    leverConnection = workspace.DescendantAdded:Connect(function(v)
        if leverEspEnabled and v:IsA("Model") and v.Name:lower():find("lever") then
            wait(0.2)
            addLeverESP()
        end
    end)
end

local function disableLeverESP()
    leverEspEnabled = false
    if leverConnection then leverConnection:Disconnect() end
    removeLeverESP()
end

-- Item ESP
local itemConnection
local function addItemESP()
    local itemsToESP = {
        {name = "Vitamins", emoji = "üíä", color = Color3.fromRGB(0, 255, 0)},
        {name = "Lockpick", emoji = "üîì", color = Color3.fromRGB(255, 255, 0)},
        {name = "FlashlightPickup", emoji = "üî¶", color = Color3.fromRGB(255, 255, 255)},
        {name = "Lighter", emoji = "üî•", color = Color3.fromRGB(255, 100, 0)},
        {name = "Candle", emoji = "üïØÔ∏è", color = Color3.fromRGB(255, 200, 100)},
        {name = "Crucifix", emoji = "‚úùÔ∏è", color = Color3.fromRGB(255, 215, 0)},
        {name = "Bandage", emoji = "ü©π", color = Color3.fromRGB(255, 100, 100)},
        {name = "SkeletonKey", emoji = "üîë", color = Color3.fromRGB(200, 200, 200)},
        {name = "Shakelight", emoji = "üí°", color = Color3.fromRGB(100, 200, 255)}
    }
    
    for _, v in pairs(workspace:GetDescendants()) do
        for _, itemData in pairs(itemsToESP) do
            if v:IsA("Model") and v.Name == itemData.name and not v:FindFirstChild("ESP") then
                local part = v.PrimaryPart or v:FindFirstChildWhichIsA("BasePart")
                if part then
                    local esp = createESP(part, itemData.color, itemData.emoji .. " " .. itemData.name)
                    if esp then table.insert(itemEspObjects, esp) end
                end
            end
        end
    end
end

local function removeItemESP()
    for _, esp in pairs(itemEspObjects) do pcall(function() esp:Destroy() end) end
    itemEspObjects = {}
end

local function enableItemESP()
    itemEspEnabled = true
    addItemESP()
    if itemConnection then itemConnection:Disconnect() end
    itemConnection = workspace.DescendantAdded:Connect(function(v)
        if itemEspEnabled and v:IsA("Model") then
            wait(0.2)
            addItemESP()
        end
    end)
end

local function disableItemESP()
    itemEspEnabled = false
    if itemConnection then itemConnection:Disconnect() end
    removeItemESP()
end

-- Auto Figure Code
local autoFigureEnabled = false

local function collectFigureCode()
    collectedCode = {}
    for _, paper in pairs(workspace:GetDescendants()) do
        if paper:IsA("Model") and paper.Name == "Paper" then
            for _, gui in pairs(paper:GetDescendants()) do
                if gui:IsA("SurfaceGui") then
                    for _, img in pairs(gui:GetDescendants()) do
                        if img:IsA("ImageLabel") then
                            local imgId = img.Image
                            if imgId and imgId ~= "" then
                                -- Extract number from image ID
                                for i = 0, 9 do
                                    if imgId:find(tostring(i)) then
                                        table.insert(collectedCode, i)
                                        break
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    return collectedCode
end

local function autoInputCode()
    local code = collectFigureCode()
    if #code > 0 then
        print("Collected code:", table.concat(code, ""))
        for _, room in pairs(workspace.CurrentRooms:GetChildren()) do
            for _, door in pairs(room:GetDescendants()) do
                if door:IsA("Model") and door.Name == "Door" then
                    local lock = door:FindFirstChild("Lock", true)
                    if lock then
                        for _, button in pairs(lock:GetDescendants()) do
                            if button:IsA("ProximityPrompt") then
                                for _, num in pairs(code) do
                                    pcall(function()
                                        fireproximityprompt(button)
                                    end)
                                    wait(0.3)
                                end
                            end
                        end
                    end
                end
            end
        end
    end
end

local function enableAutoFigure()
    autoFigureEnabled = true
    task.spawn(function()
        while autoFigureEnabled do
            autoInputCode()
            task.wait(2)
        end
    end)
end

local function disableAutoFigure()
    autoFigureEnabled = false
end

-- Auto Collect Items
local autoCollectEnabled = false

local function autoCollectItems()
    if not autoCollectEnabled then return end
    
    local itemsToCollect = {
        "Vitamins",
        "Lockpick",
        "FlashlightPickup",
        "Lighter",
        "Candle",
        "Crucifix",
        "Bandage",
        "SkeletonKey",
        "Shakelight"
    }
    
    for _, item in pairs(workspace:GetDescendants()) do
        for _, targetItem in pairs(itemsToCollect) do
            if item:IsA("Model") and item.Name == targetItem then
                local prompt = item:FindFirstChildOfClass("ProximityPrompt", true)
                if prompt and prompt.Enabled then
                    pcall(function()
                        fireproximityprompt(prompt)
                    end)
                end
            end
        end
    end
end

local function enableAutoCollect()
    autoCollectEnabled = true
    task.spawn(function()
        while autoCollectEnabled do
            autoCollectItems()
            task.wait(1)
        end
    end)
end

local function disableAutoCollect()
    autoCollectEnabled = false
end

print("Step 14: All ESP functions + Auto features ready!")

-- Infinite Vitamins
local function enableInfVitamins()
    infVitaminsEnabled = true
    task.spawn(function()
        while infVitaminsEnabled do
            for _, item in pairs(workspace:GetDescendants()) do
                if item:IsA("Model") and item.Name == "Vitamins" then
                    local prompt = item:FindFirstChildOfClass("ProximityPrompt", true)
                    if prompt and prompt.Enabled then
                        pcall(function() fireproximityprompt(prompt) end)
                    end
                end
            end
            task.wait(1)
        end
    end)
    
    local function patch(vit)
        for _, v in pairs(vit:GetDescendants()) do
            if v:IsA("IntValue") and v.Name == "Uses" then
                v.Value = 999999
                local conn = v:GetPropertyChangedSignal("Value"):Connect(function()
                    if infVitaminsEnabled then v.Value = 999999 end
                end)
                table.insert(vitaminConnections, conn)
            end
        end
    end
    
    for _, item in pairs(player.Character:GetDescendants()) do
        if item:IsA("Model") and item.Name == "Vitamins" then
            patch(item)
        end
    end
    
    local conn = player.Character.DescendantAdded:Connect(function(item)
        if infVitaminsEnabled and item:IsA("Model") and item.Name == "Vitamins" then
            task.wait(0.2)
            patch(item)
        end
    end)
    table.insert(vitaminConnections, conn)
end

local function disableInfVitamins()
    infVitaminsEnabled = false
    for _, conn in pairs(vitaminConnections) do
        pcall(function() conn:Disconnect() end)
    end
    vitaminConnections = {}
end

-- Auto Unlock
local function enableAutoUnlock()
    autoUnlockEnabled = true
    task.spawn(function()
        while autoUnlockEnabled do
            pcall(function()
                for _, room in pairs(workspace.CurrentRooms:GetChildren()) do
                    for _, obj in pairs(room:GetDescendants()) do
                        if obj:IsA("Model") and obj.Name == "Door" then
                            local lock = obj:FindFirstChild("Lock", true)
                            if lock then
                                local prompt = lock:FindFirstChildOfClass("ProximityPrompt")
                                if prompt and prompt.Enabled then
                                    local hasKey = false
                                    for _, item in pairs(player.Character:GetChildren()) do
                                        if item.Name:lower():find("key") then
                                            hasKey = true
                                            break
                                        end
                                    end
                                    if hasKey then
                                        fireproximityprompt(prompt)
                                    end
                                end
                            end
                        end
                    end
                end
            end)
            task.wait(0.5)
        end
    end)
end

print("Step 15: Auto functions ready!")

-- Entity Notifications
local function setupEntityNotif()
    workspace.ChildAdded:Connect(function(child)
        if rushNotifEnabled then
            if child.Name == "RushMoving" or child.Name == "AmbushMoving" then
                local name = child.Name:gsub("Moving", ""):upper()
                Obsidian:Notify({Title = "‚ö†Ô∏è " .. name .. "!", Content = "HIDE NOW!", Duration = 5})
            elseif child.Name == "Eyes" or child.Name == "Screech" or child.Name == "BackdoorLookman" or child.Name:find("Timothy") then
                Obsidian:Notify({Title = "üëÅÔ∏è " .. child.Name:upper() .. "!", Content = "Look away!", Duration = 4})
            end
        end
    end)
end

print("Step 16: Entity notifications ready!")

-- Create Tabs
local InfoTab = Window:CreateTab("üìã Info")
local MainTab = Window:CreateTab("‚öôÔ∏è Main")
local ESPTab = Window:CreateTab("üëÅÔ∏è ESP")
local AutoTab = Window:CreateTab("ü§ñ Auto")

print("Step 17: Tabs created!")

-- Info Tab
InfoTab:CreateParagraph({Title = "üë§ Player", Content = "Name: " .. player.Name .. "\nDisplay: " .. player.DisplayName .. (isOwner and "\n\nüëë OWNER STATUS" or "")})
InfoTab:CreateParagraph({Title = "üìå Features", Content = "‚Ä¢ ESP Auto-Refresh (No manual refresh)\n‚Ä¢ ESP shows FAKE doors in RED\n‚Ä¢ All Entity ESP\n‚Ä¢ Player ESP\n‚Ä¢ Anti-Detect Speed"})

print("Step 18: Info tab populated!")

-- Main Tab
MainTab:CreateSlider({
    Name = "Speed (Anti-Detect)",
    Range = {1, 4},
    Increment = 0.1,
    Suffix = "x",
    CurrentValue = 1,
    Callback = function(v) setSpeed(v) end
})

MainTab:CreateToggle({
    Name = "Entity Notifications",
    CurrentValue = false,
    Callback = function(v) rushNotifEnabled = v end
})

print("Step 19: Main tab populated!")

-- ESP Tab
ESPTab:CreateParagraph({Title = "üö™ Door ESP Info", Content = "Door ESP automatically shows FAKE doors in RED!\nNo need to toggle separately."})

ESPTab:CreateToggle({
    Name = "Door ESP (Auto-Refresh)",
    CurrentValue = false,
    Callback = function(v)
        if v then enableDoorESP() else disableDoorESP() end
    end
})

ESPTab:CreateToggle({
    Name = "Key ESP (Auto-Refresh)",
    CurrentValue = false,
    Callback = function(v)
        if v then enableKeyESP() else disableKeyESP() end
    end
})

ESPTab:CreateToggle({
    Name = "All Entity ESP (Auto-Refresh)",
    CurrentValue = false,
    Callback = function(v)
        if v then enableEntityESP() else disableEntityESP() end
    end
})

ESPTab:CreateToggle({
    Name = "Player ESP",
    CurrentValue = false,
    Callback = function(v)
        if v then enablePlayerESP() else disablePlayerESP() end
    end
})

ESPTab:CreateToggle({
    Name = "Figure Book & Code ESP",
    CurrentValue = false,
    Callback = function(v)
        if v then enableFigureESP() else disableFigureESP() end
    end
})

ESPTab:CreateToggle({
    Name = "Lever ESP",
    CurrentValue = false,
    Callback = function(v)
        if v then enableLeverESP() else disableLeverESP() end
    end
})

ESPTab:CreateToggle({
    Name = "Item ESP (All Items)",
    CurrentValue = false,
    Callback = function(v)
        if v then enableItemESP() else disableItemESP() end
    end
})

ESPTab:CreateButton({
    Name = "Refresh All ESP",
    Callback = function()
        if doorEspEnabled then removeDoorESP() addDoorESP() end
        if keyEspEnabled then removeKeyESP() addKeyESP() end
        if entityEspEnabled then removeEntityESP() addEntityESP() end
        if playerEspEnabled then removePlayerESP() addPlayerESP() end
        if figureEspEnabled then removeFigureESP() addFigureESP() end
        if leverEspEnabled then removeLeverESP() addLeverESP() end
        if itemEspEnabled then removeItemESP() addItemESP() end
        Obsidian:Notify({Title = "‚úì Refreshed", Content = "All ESP updated", Duration = 2})
    end
})

print("Step 20: ESP tab populated!")

-- Auto Tab
AutoTab:CreateParagraph({Title = "üîß Figure Features", Content = "Auto collect code from papers and input to door!"})

AutoTab:CreateToggle({
    Name = "Auto Figure Code & Door",
    CurrentValue = false,
    Callback = function(v)
        if v then enableAutoFigure() else disableAutoFigure() end
    end
})

AutoTab:CreateToggle({
    Name = "Auto Unlock Doors",
    CurrentValue = false,
    Callback = function(v)
        autoUnlockEnabled = v
        if v then enableAutoUnlock() end
    end
})

AutoTab:CreateToggle({
    Name = "Auto Collect Items",
    CurrentValue = false,
    Callback = function(v)
        if v then enableAutoCollect() else disableAutoCollect() end
    end
})

AutoTab:CreateToggle({
    Name = "Infinite Vitamins",
    CurrentValue = false,
    Callback = function(v)
        if v then enableInfVitamins() else disableInfVitamins() end
    end
})

print("Step 21: Auto tab populated!")

-- Setup
setupEntityNotif()

print("Step 22: Entity notifications setup complete!")

local hours = math.floor(timeLeft)
local minutes = math.floor((timeLeft - hours) * 60)

Obsidian:Notify({
    Title = "Waner Hub Loaded!",
    Content = (isOwner and "üëë Owner " or "‚ú® ") .. player.Name .. (keyValid and string.format("\n‚è∞ Key: %dh %dm", hours, minutes) or ""),
    Duration = 5
})

print("Step 23: Notification sent!")
print("")
print("=================================")
print("‚úÖ WANER HUB LOADED SUCCESSFULLY!")
print("=================================")
print("User: " .. player.Name .. (isOwner and " (OWNER)" or ""))
if keyValid then
    print("Key remaining: " .. hours .. "h " .. minutes .. "m")
end
print("=================================")
print("")
print("All features ready to use!")
print("Enjoy Waner Hub! üöÄ")
