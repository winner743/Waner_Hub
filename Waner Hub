       -- WANER HUB v4.0 | FIXED ESP SYSTEM WITH CONSTANT SIZE & BRIGHT OUTLINE
print("=== WENER HUB v4.0 ULTIMATE COMPLETE WITH FIXED ESP ===")
print("üöÄ Loading the most advanced Doors script with proper ESP...")

-- ============================================================================
-- SERVICES & INITIALIZATION
-- ============================================================================

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Lighting = game:GetService("Lighting")
local UserInputService = game:GetService("UserInputService")
local TeleportService = game:GetService("TeleportService")
local player = Players.LocalPlayer

-- Wait for character
repeat wait() until player.Character
repeat wait() until player.Character:FindFirstChild("HumanoidRootPart")

-- ============================================================================
-- VARIABLES UNTUK SEMUA FITUR
-- ============================================================================

local espObjects = {}
local currentSpeed = 16
local godModeEnabled = false
local noclipEnabled = false
local doorEspEnabled = false
local keyEspEnabled = false
local entityEspEnabled = false
local playerEspEnabled = false
local itemEspEnabled = false
local bookEspEnabled = false
local autoCollectEnabled = false
local autoUnlockEnabled = false
local infVitaminsEnabled = false
local rushNotifEnabled = false
local allEntityNotifications = false
local bypassAntiCheat = false

local noclipConnection
local autoCollectConnection
local autoUnlockConnection
local infVitaminsConnection
local entityConnections = {}
local godModeConnections = {}
local bypassConnections = {}

-- ============================================================================
-- AUTO EXECUTE & AUTO RECONNECT SETUP
-- ============================================================================

local function setupAutoExecute()
    local autoExecuteCode = [[
-- WANER HUB ULTIMATE AUTO EXECUTE
print("üöÄ WANER HUB Auto Execute Triggered!")
loadstring(game:HttpGet("https://raw.githubusercontent.com/WanerScripts/WenerHub/main/doors-ultimate.lua"))()
]]
    
    if not isfolder("WenerHub") then
        makefolder("WenerHub")
    end
    
    writefile("WenerHub/AutoExecute.lua", autoExecuteCode)
    print("üöÄ Auto Execute: CONFIGURED")
end

local function setupAutoReconnect()
    local disconnectDetected = false
    
    local function createDisconnectGUI()
        local ScreenGui = Instance.new("ScreenGui")
        ScreenGui.Name = "WenerDisconnectGUI"
        ScreenGui.ResetOnSpawn = false
        ScreenGui.Parent = game.CoreGui
        
        local Blur = Instance.new("BlurEffect")
        Blur.Size = 30
        Blur.Parent = Lighting
        
        local Background = Instance.new("Frame")
        Background.Size = UDim2.new(1, 0, 1, 0)
        Background.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        Background.BackgroundTransparency = 0.4
        Background.Parent = ScreenGui
        
        local DisconnectPanel = Instance.new("Frame")
        DisconnectPanel.Size = UDim2.new(0, 500, 0, 300)
        DisconnectPanel.Position = UDim2.new(0.5, -250, 0.5, -150)
        DisconnectPanel.BackgroundColor3 = Color3.fromRGB(15, 15, 25)
        DisconnectPanel.Parent = ScreenGui
        
        local Corner = Instance.new("UICorner")
        Corner.CornerRadius = UDim.new(0, 20)
        Corner.Parent = DisconnectPanel
        
        local Title = Instance.new("TextLabel")
        Title.Size = UDim2.new(1, 0, 0, 60)
        Title.BackgroundTransparency = 1
        Title.Text = "‚ö†Ô∏è CONNECTION LOST"
        Title.TextColor3 = Color3.fromRGB(255, 255, 255)
        Title.Font = Enum.Font.GothamBold
        Title.TextSize = 32
        Title.Parent = DisconnectPanel
        
        local Message = Instance.new("TextLabel")
        Message.Size = UDim2.new(1, -40, 0, 100)
        Message.Position = UDim2.new(0, 20, 0, 80)
        Message.BackgroundTransparency = 1
        Message.Text = "üîå Disconnected from server\nüì° Auto Reconnect in 5 seconds..."
        Message.TextColor3 = Color3.fromRGB(200, 200, 200)
        Message.Font = Enum.Font.Gotham
        Message.TextSize = 18
        Message.TextWrapped = true
        Message.Parent = DisconnectPanel
        
        local ReconnectBtn = Instance.new("TextButton")
        ReconnectBtn.Size = UDim2.new(0, 200, 0, 50)
        ReconnectBtn.Position = UDim2.new(0.5, -100, 0, 200)
        ReconnectBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
        ReconnectBtn.Text = "üîÑ Reconnect Now"
        ReconnectBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        ReconnectBtn.Font = Enum.Font.GothamBold
        ReconnectBtn.TextSize = 18
        ReconnectBtn.Parent = DisconnectPanel
        
        local BtnCorner = Instance.new("UICorner")
        BtnCorner.CornerRadius = UDim.new(0, 10)
        BtnCorner.Parent = ReconnectBtn
        
        local countdown = 5
        task.spawn(function()
            while countdown > 0 do
                Message.Text = string.format("üîå Disconnected from server\nüì° Auto Reconnect in %d seconds...", countdown)
                countdown = countdown - 1
                wait(1)
            end
            TeleportService:Teleport(game.PlaceId, player)
        end)
        
        ReconnectBtn.MouseButton1Click:Connect(function()
            TeleportService:Teleport(game.PlaceId, player)
        end)
    end
    
    local lastHeartbeat = tick()
    RunService.Heartbeat:Connect(function()
        lastHeartbeat = tick()
    end)
    
    task.spawn(function()
        while true do
            wait(1)
            if tick() - lastHeartbeat > 8 and not disconnectDetected then
                disconnectDetected = true
                createDisconnectGUI()
                break
            end
        end
    end)
end

setupAutoExecute()
setupAutoReconnect()

-- ============================================================================
-- LOADING SCREEN
-- ============================================================================

local function createLoadingScreen()
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "WanerLoading"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = game.CoreGui
    
    local Blur = Instance.new("BlurEffect")
    Blur.Size = 0
    Blur.Parent = Lighting
    
    local Background = Instance.new("Frame")
    Background.Size = UDim2.new(1, 0, 1, 0)
    Background.BackgroundColor3 = Color3.fromRGB(5, 5, 10)
    Background.BackgroundTransparency = 1
    Background.Parent = ScreenGui
    
    local Container = Instance.new("Frame")
    Container.Size = UDim2.new(0, 600, 0, 350)
    Container.Position = UDim2.new(0.5, -300, 0.5, -175)
    Container.BackgroundColor3 = Color3.fromRGB(15, 15, 25)
    Container.BackgroundTransparency = 1
    Container.Parent = ScreenGui
    
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 25)
    Corner.Parent = Container
    
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, 0, 0, 80)
    Title.Position = UDim2.new(0, 0, 0, 40)
    Title.BackgroundTransparency = 1
    Title.Text = "WENER HUB v4.0"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 54
    Title.TextTransparency = 1
    Title.Parent = Container
    
    local Subtitle = Instance.new("TextLabel")
    Subtitle.Size = UDim2.new(1, 0, 0, 40)
    Subtitle.Position = UDim2.new(0, 0, 0, 120)
    Subtitle.BackgroundTransparency = 1
    Subtitle.Text = "ULTIMATE EDITION WITH FIXED ESP"
    Subtitle.TextColor3 = Color3.fromRGB(200, 200, 200)
    Subtitle.Font = Enum.Font.Gotham
    Subtitle.TextSize = 24
    Subtitle.TextTransparency = 1
    Subtitle.Parent = Container
    
    local Status = Instance.new("TextLabel")
    Status.Size = UDim2.new(1, 0, 0, 40)
    Status.Position = UDim2.new(0, 0, 0, 180)
    Status.BackgroundTransparency = 1
    Status.Text = "Initializing fixed ESP systems..."
    Status.TextColor3 = Color3.fromRGB(100, 255, 100)
    Status.Font = Enum.Font.Gotham
    Status.TextSize = 18
    Status.TextTransparency = 1
    Status.Parent = Container
    
    local Progress = Instance.new("Frame")
    Progress.Size = UDim2.new(0, 0, 0, 8)
    Progress.Position = UDim2.new(0.075, 0, 0, 240)
    Progress.BackgroundColor3 = Color3.fromRGB(139, 0, 255)
    Progress.BorderSizePixel = 0
    Progress.BackgroundTransparency = 1
    Progress.Parent = Container
    
    local ProgressCorner = Instance.new("UICorner")
    ProgressCorner.CornerRadius = UDim.new(1, 0)
    ProgressCorner.Parent = Progress
    
    task.spawn(function()
        TweenService:Create(Blur, TweenInfo.new(1), {Size = 35}):Play()
        TweenService:Create(Background, TweenInfo.new(1), {BackgroundTransparency = 0.2}):Play()
        TweenService:Create(Container, TweenInfo.new(1), {BackgroundTransparency = 0.1}):Play()
        wait(1)
        
        TweenService:Create(Title, TweenInfo.new(0.8), {TextTransparency = 0}):Play()
        wait(0.4)
        TweenService:Create(Subtitle, TweenInfo.new(0.8), {TextTransparency = 0}):Play()
        wait(0.4)
        TweenService:Create(Status, TweenInfo.new(0.8), {TextTransparency = 0}):Play()
        TweenService:Create(Progress, TweenInfo.new(0.8), {BackgroundTransparency = 0}):Play()
        wait(0.8)
        
        local stages = {
            {text = "üöÄ Setting up Auto Execute...", progress = 0.2},
            {text = "üîÑ Configuring Auto Reconnect...", progress = 0.4},
            {text = "üëÅÔ∏è Loading Fixed ESP Systems...", progress = 0.6},
            {text = "üõ°Ô∏è Initializing Protection...", progress = 0.8},
            {text = "‚úÖ All Systems Ready!", progress = 1.0}
        }
        
        for _, stage in ipairs(stages) do
            Status.Text = stage.text
            TweenService:Create(Progress, TweenInfo.new(1), {Size = UDim2.new(0.85 * stage.progress, 0, 0, 8)}):Play()
            wait(1)
        end
        
        wait(1)
        
        TweenService:Create(Title, TweenInfo.new(0.8), {TextTransparency = 1}):Play()
        TweenService:Create(Subtitle, TweenInfo.new(0.8), {TextTransparency = 1}):Play()
        TweenService:Create(Status, TweenInfo.new(0.8), {TextTransparency = 1}):Play()
        TweenService:Create(Progress, TweenInfo.new(0.8), {BackgroundTransparency = 1}):Play()
        TweenService:Create(Container, TweenInfo.new(0.8), {BackgroundTransparency = 1}):Play()
        TweenService:Create(Background, TweenInfo.new(0.8), {BackgroundTransparency = 1}):Play()
        TweenService:Create(Blur, TweenInfo.new(1), {Size = 0}):Play()
        wait(1.2)
        
        Blur:Destroy()
        ScreenGui:Destroy()
    end)
end

createLoadingScreen()
wait(6)

-- ============================================================================
-- KEY SYSTEM DENGAN EXPIRE 2 JAM
-- ============================================================================

local KeySystemEnabled = true
local CorrectKey = "Wene-you"
local KeyExpireTime = 7200

local function checkKey()
    if not isfolder("WenerHub") then
        makefolder("WenerHub")
        return false
    end
    
    if not isfile("WenerHub/Key.json") then
        return false
    end
    
    local success, data = pcall(function()
        return game:GetService("HttpService"):JSONDecode(readfile("WenerHub/Key.json"))
    end)
    
    if not success or not data then return false end
    
    local currentTime = os.time()
    if data.key == CorrectKey and data.expire_time and currentTime < data.expire_time then
        return true
    end
    
    return false
end

local function saveKey()
    local currentTime = os.time()
    local expireTime = currentTime + KeyExpireTime
    
    local keyData = {
        key = CorrectKey,
        save_time = currentTime,
        expire_time = expireTime,
        user = player.Name,
        version = "v4.0_Ultimate"
    }
    
    writefile("WenerHub/Key.json", game:GetService("HttpService"):JSONEncode(keyData))
end

local ownerUsername = "winnertupiq52"
local isOwner = player.Name == ownerUsername

if KeySystemEnabled and not checkKey() and not isOwner then
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "WanerKeySystem"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = game.CoreGui
    
    local Blur = Instance.new("BlurEffect")
    Blur.Size = 0
    Blur.Parent = Lighting
    
    local Background = Instance.new("Frame")
    Background.Size = UDim2.new(1, 0, 1, 0)
    Background.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    Background.BackgroundTransparency = 1
    Background.Parent = ScreenGui
    
    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 500, 0, 350)
    MainFrame.Position = UDim2.new(0.5, -250, 0.5, -175)
    MainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 25)
    MainFrame.BackgroundTransparency = 1
    MainFrame.Parent = ScreenGui
    
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 25)
    Corner.Parent = MainFrame
    
    TweenService:Create(Blur, TweenInfo.new(0.8), {Size = 30}):Play()
    TweenService:Create(Background, TweenInfo.new(0.8), {BackgroundTransparency = 0.3}):Play()
    TweenService:Create(MainFrame, TweenInfo.new(0.8), {BackgroundTransparency = 0.1}):Play()
    wait(0.8)
    
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, 0, 0, 80)
    Title.BackgroundTransparency = 1
    Title.Text = "üîê WENER HUB KEY ACCESS"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 28
    Title.Parent = MainFrame
    
    local ExpireInfo = Instance.new("TextLabel")
    ExpireInfo.Size = UDim2.new(1, -40, 0, 30)
    ExpireInfo.Position = UDim2.new(0, 20, 0, 80)
    ExpireInfo.BackgroundTransparency = 1
    ExpireInfo.Text = "‚è∞ Key valid for 2 hours after verification"
    ExpireInfo.TextColor3 = Color3.fromRGB(255, 165, 0)
    ExpireInfo.Font = Enum.Font.Gotham
    ExpireInfo.TextSize = 16
    ExpireInfo.Parent = MainFrame
    
    local KeyInput = Instance.new("TextBox")
    KeyInput.Size = UDim2.new(1, -40, 0, 55)
    KeyInput.Position = UDim2.new(0, 20, 0, 130)
    KeyInput.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    KeyInput.PlaceholderText = "Enter Access Key: Wene-***"
    KeyInput.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
    KeyInput.Text = ""
    KeyInput.TextColor3 = Color3.fromRGB(255, 255, 255)
    KeyInput.Font = Enum.Font.Gotham
    KeyInput.TextSize = 20
    KeyInput.Parent = MainFrame
    
    local InputCorner = Instance.new("UICorner")
    InputCorner.CornerRadius = UDim.new(0, 15)
    InputCorner.Parent = KeyInput
    
    local SubmitBtn = Instance.new("TextButton")
    SubmitBtn.Size = UDim2.new(1, -40, 0, 55)
    SubmitBtn.Position = UDim2.new(0, 20, 0, 210)
    SubmitBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
    SubmitBtn.Text = "‚úì VERIFY KEY"
    SubmitBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    SubmitBtn.Font = Enum.Font.GothamBold
    SubmitBtn.TextSize = 20
    SubmitBtn.Parent = MainFrame
    
    local BtnCorner = Instance.new("UICorner")
    BtnCorner.CornerRadius = UDim.new(0, 15)
    BtnCorner.Parent = SubmitBtn
    
    local Info = Instance.new("TextLabel")
    Info.Size = UDim2.new(1, -40, 0, 50)
    Info.Position = UDim2.new(0, 20, 0, 280)
    Info.BackgroundTransparency = 1
    Info.Text = "üîë Get key from Discord or contact owner\nüíé 30+ Premium Features"
    Info.TextColor3 = Color3.fromRGB(200, 200, 200)
    Info.Font = Enum.Font.Gotham
    Info.TextSize = 14
    Info.TextWrapped = true
    Info.Parent = MainFrame
    
    local submitted = false
    SubmitBtn.MouseButton1Click:Connect(function()
        if KeyInput.Text == CorrectKey then
            saveKey()
            submitted = true
            
            SubmitBtn.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
            SubmitBtn.Text = "‚úÖ SUCCESS! Key valid for 2 hours"
            
            wait(1)
            
            TweenService:Create(MainFrame, TweenInfo.new(0.8), {BackgroundTransparency = 1}):Play()
            TweenService:Create(Title, TweenInfo.new(0.8), {TextTransparency = 1}):Play()
            TweenService:Create(ExpireInfo, TweenInfo.new(0.8), {TextTransparency = 1}):Play()
            TweenService:Create(KeyInput, TweenInfo.new(0.8), {BackgroundTransparency = 1, TextTransparency = 1}):Play()
            TweenService:Create(SubmitBtn, TweenInfo.new(0.8), {BackgroundTransparency = 1, TextTransparency = 1}):Play()
            TweenService:Create(Info, TweenInfo.new(0.8), {TextTransparency = 1}):Play()
            TweenService:Create(Background, TweenInfo.new(0.8), {BackgroundTransparency = 1}):Play()
            TweenService:Create(Blur, TweenInfo.new(1), {Size = 0}):Play()
            wait(1.2)
            
            Blur:Destroy()
            ScreenGui:Destroy()
        else
            SubmitBtn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
            SubmitBtn.Text = "‚ùå INVALID KEY"
            wait(1.5)
            SubmitBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
            SubmitBtn.Text = "‚úì VERIFY KEY"
        end
    end)
    
    repeat wait(0.1) until submitted
end

-- ============================================================================
-- WELCOME SCREEN
-- ============================================================================

local function createWelcomeScreen()
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "WenerWelcome"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = game.CoreGui
    
    local Blur = Instance.new("BlurEffect")
    Blur.Size = 0
    Blur.Parent = Lighting
    
    local Background = Instance.new("Frame")
    Background.Size = UDim2.new(1, 0, 1, 0)
    Background.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    Background.BackgroundTransparency = 1
    Background.Parent = ScreenGui
    
    local WelcomeText = Instance.new("TextLabel")
    WelcomeText.Size = UDim2.new(0.8, 0, 0.2, 0)
    WelcomeText.Position = UDim2.new(0.1, 0, 0.3, 0)
    WelcomeText.BackgroundTransparency = 1
    WelcomeText.Text = "Welcome " .. player.DisplayName .. " To WENER Hub"
    WelcomeText.TextColor3 = Color3.fromRGB(139, 0, 255)
    WelcomeText.Font = Enum.Font.GothamBold
    WelcomeText.TextSize = 48
    WelcomeText.TextStrokeTransparency = 0
    WelcomeText.TextTransparency = 1
    WelcomeText.Parent = ScreenGui
    
    local HubText = Instance.new("TextLabel")
    HubText.Size = UDim2.new(1, 0, 0.3, 0)
    HubText.Position = UDim2.new(0, 0, 0.55, 0)
    HubText.BackgroundTransparency = 1
    HubText.Text = "W3n3r HuB"
    HubText.TextColor3 = Color3.fromRGB(255, 255, 255)
    HubText.Font = Enum.Font.GothamBold
    HubText.TextSize = 72
    HubText.TextStrokeTransparency = 0
    HubText.TextTransparency = 1
    HubText.Parent = ScreenGui
    
    task.spawn(function()
        TweenService:Create(Blur, TweenInfo.new(1), {Size = 25}):Play()
        TweenService:Create(Background, TweenInfo.new(1), {BackgroundTransparency = 0.3}):Play()
        wait(1)
        
        TweenService:Create(WelcomeText, TweenInfo.new(1.5), {TextTransparency = 0}):Play()
        wait(2)
        
        TweenService:Create(HubText, TweenInfo.new(0.5), {TextTransparency = 0}):Play()
        wait(0.5)
        
        local glitchTexts = {
            "W3n3r HuB", "W‚Ç¨n‚Ç¨r H‚à™B", "W¬£n¬£r HŒºB", "W‚ààn‚ààr H‚à™√ü",
            "W‚àÇn‚àÇr Hub", "Wen‚Ç¨r Hub", "Wen3r Hub", "Wener Hub"
        }
        
        for i = 1, 15 do
            HubText.Text = glitchTexts[math.random(1, #glitchTexts)]
            HubText.TextColor3 = Color3.fromRGB(
                math.random(100, 255),
                math.random(100, 255), 
                math.random(100, 255)
            )
            HubText.Position = UDim2.new(
                math.random(-5, 5) / 100,
                0,
                0.55 + math.random(-2, 2) / 100,
                0
            )
            wait(0.1)
        end
        
        TweenService:Create(HubText, TweenInfo.new(1), {
            TextColor3 = Color3.fromRGB(139, 0, 255),
            Position = UDim2.new(0, 0, 0.55, 0)
        }):Play()
        HubText.Text = "Wener Hub"
        
        wait(3)
        
        TweenService:Create(WelcomeText, TweenInfo.new(1.5), {TextTransparency = 1}):Play()
        TweenService:Create(HubText, TweenInfo.new(1.5), {TextTransparency = 1}):Play()
        TweenService:Create(Background, TweenInfo.new(1.5), {BackgroundTransparency = 1}):Play()
        TweenService:Create(Blur, TweenInfo.new(1.5), {Size = 0}):Play()
        
        wait(1.5)
        ScreenGui:Destroy()
        Blur:Destroy()
    end)
end

createWelcomeScreen()

-- ============================================================================
-- PERMANENT LOGO
-- ============================================================================

local function createPermanentLogo()
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "WanerLogo"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = game.CoreGui
    
    local Container = Instance.new("Frame")
    Container.Size = UDim2.new(0, 500, 0, 90)
    Container.Position = UDim2.new(0.5, -250, 0.02, 0)
    Container.BackgroundTransparency = 1
    Container.Parent = ScreenGui
    
    local WenerText = Instance.new("TextLabel")
    WenerText.Size = UDim2.new(0, 170, 1, 0)
    WenerText.Position = UDim2.new(0, 0, 0, 0)
    WenerText.BackgroundTransparency = 1
    WenerText.Text = "WENER"
    WenerText.TextColor3 = Color3.fromRGB(139, 0, 255)
    WenerText.Font = Enum.Font.GothamBold
    WenerText.TextSize = 44
    WenerText.TextStrokeTransparency = 0.3
    WenerText.TextXAlignment = Enum.TextXAlignment.Right
    WenerText.TextTransparency = 1
    WenerText.Parent = Container
    
    local HubText = Instance.new("TextLabel")
    HubText.Size = UDim2.new(0, 110, 1, 0)
    HubText.Position = UDim2.new(0, 180, 0, 0)
    HubText.BackgroundTransparency = 1
    HubText.Text = "HUB"
    HubText.TextColor3 = Color3.fromRGB(139, 0, 255)
    HubText.Font = Enum.Font.GothamBold
    HubText.TextSize = 44
    HubText.TextStrokeTransparency = 0.3
    HubText.TextXAlignment = Enum.TextXAlignment.Left
    HubText.TextTransparency = 1
    HubText.Parent = Container
    
    local VersionText = Instance.new("TextLabel")
    VersionText.Size = UDim2.new(0, 90, 0, 25)
    VersionText.Position = UDim2.new(0, 300, 1, -25)
    VersionText.BackgroundTransparency = 1
    VersionText.Text = "v4.0 Ultimate"
    VersionText.TextColor3 = Color3.fromRGB(200, 200, 200)
    VersionText.Font = Enum.Font.Gotham
    VersionText.TextSize = 16
    VersionText.TextTransparency = 1
    VersionText.Parent = Container
    
    if isOwner then
        local OwnerText = Instance.new("TextLabel")
        OwnerText.Size = UDim2.new(0, 120, 0, 25)
        OwnerText.Position = UDim2.new(0, 300, 0, 0)
        OwnerText.BackgroundTransparency = 1
        OwnerText.Text = "üëë OWNER ACCESS"
        OwnerText.TextColor3 = Color3.fromRGB(255, 215, 0)
        OwnerText.Font = Enum.Font.GothamBold
        OwnerText.TextSize = 14
        OwnerText.TextTransparency = 1
        OwnerText.Parent = Container
        
        task.spawn(function()
            wait(14)
            TweenService:Create(OwnerText, TweenInfo.new(1.5), {TextTransparency = 0}):Play()
        end)
    end
    
    task.spawn(function()
        wait(14)
        TweenService:Create(WenerText, TweenInfo.new(1.5), {TextTransparency = 0}):Play()
        wait(0.3)
        TweenService:Create(HubText, TweenInfo.new(1.5), {TextTransparency = 0}):Play()
        wait(0.3)
        TweenService:Create(VersionText, TweenInfo.new(1.2), {TextTransparency = 0}):Play()
    end)
end

task.spawn(createPermanentLogo)

-- ============================================================================
-- FIXED ESP SYSTEM - SIZE TETAP & DENGAN OUTLINE TERANG
-- ============================================================================

local function createFixedESP(obj, text, color, espType)
    if not obj or obj:FindFirstChild("WenerESP_" .. espType) then return end
    
    -- Cek jarak maksimal
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local distance = (player.Character.HumanoidRootPart.Position - obj.Position).Magnitude
        if distance > 500 then return end
    end
    
    -- Create Highlight untuk outline terang
    local highlight = Instance.new("Highlight")
    highlight.Name = "WenerESP_" .. espType
    highlight.Adornee = obj.Parent or obj
    highlight.FillColor = color
    highlight.FillTransparency = 0.5
    highlight.OutlineColor = color
    highlight.OutlineTransparency = 0
    highlight.Parent = obj
    
    -- Create BillboardGui dengan size TETAP (tidak berubah saat zoom)
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "WenerESP_" .. espType .. "_Bill"
    billboard.Adornee = obj
    billboard.Size = UDim2.new(4, 0, 2, 0) -- SIZE TETAP DAN LEBIH BESAR
    billboard.StudsOffset = Vector3.new(0, 3, 0)
    billboard.AlwaysOnTop = true
    billboard.MaxDistance = 500
    billboard.LightInfluence = 0
    billboard.Parent = obj
    
    -- Background frame
    local bgFrame = Instance.new("Frame")
    bgFrame.Size = UDim2.new(1, 0, 1, 0)
    bgFrame.BackgroundColor3 = Color3.new(0, 0, 0)
    bgFrame.BackgroundTransparency = 0.3
    bgFrame.BorderSizePixel = 0
    bgFrame.Parent = billboard
    
    local bgCorner = Instance.new("UICorner")
    bgCorner.CornerRadius = UDim.new(0, 8)
    bgCorner.Parent = bgFrame
    
    -- Stroke untuk frame (outline terang)
    local frameStroke = Instance.new("UIStroke")
    frameStroke.Color = color
    frameStroke.Thickness = 3
    frameStroke.Transparency = 0
    frameStroke.Parent = bgFrame
    
    -- Text label
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -10, 0.6, 0)
    label.Position = UDim2.new(0, 5, 0, 5)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = color
    label.TextStrokeTransparency = 0
    label.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    label.TextScaled = true
    label.Font = Enum.Font.GothamBold
    label.Parent = billboard
    
    -- Distance label
    local distanceLabel = Instance.new("TextLabel")
    distanceLabel.Size = UDim2.new(1, -10, 0.4, 0)
    distanceLabel.Position = UDim2.new(0, 5, 0.6, 0)
    distanceLabel.BackgroundTransparency = 1
    distanceLabel.Text = "0m"
    distanceLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    distanceLabel.TextStrokeTransparency = 0
    distanceLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    distanceLabel.TextScaled = true
    distanceLabel.Font = Enum.Font.Gotham
    distanceLabel.Parent = billboard
    
    -- Animation untuk highlight glow effect
    task.spawn(function()
        while highlight.Parent and obj.Parent do
            TweenService:Create(highlight, TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {
                FillTransparency = 0.8,
                OutlineTransparency = 0.2
            }):Play()
            
            TweenService:Create(frameStroke, TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {
                Transparency = 0.3
            }):Play()
            
            task.wait(1)
        end
    end)
    
    -- Update distance
    task.spawn(function()
        while billboard.Parent and obj.Parent and player.Character and player.Character:FindFirstChild("HumanoidRootPart") do
            local distance = math.floor((player.Character.HumanoidRootPart.Position - obj.Position).Magnitude)
            distanceLabel.Text = distance .. "m"
            
            -- Auto remove jika terlalu jauh
            if distance > 500 then
                if highlight then highlight:Destroy() end
                if billboard then billboard:Destroy() end
                break
            end
            
            task.wait(0.5)
        end
    end)
    
    table.insert(espObjects, {highlight = highlight, billboard = billboard})
    return {highlight, billboard}
end

-- ============================================================================
-- ESP UPDATE FUNCTIONS - FIXED & PROPER DETECTION
-- ============================================================================

local function updateDoorESP()
    if not doorEspEnabled then return end
    
    local currentRooms = workspace:FindFirstChild("CurrentRooms")
    if not currentRooms then return end
    
    for _, room in pairs(currentRooms:GetChildren()) do
        if room:IsA("Model") and tonumber(room.Name) then
            local door = room:FindFirstChild("Door")
            if door then
                local doorPart = door:FindFirstChildWhichIsA("BasePart")
                if doorPart and not doorPart:FindFirstChild("WenerESP_door") then
                    createFixedESP(doorPart, "üö™ Door " .. room.Name, Color3.fromRGB(0, 255, 0), "door")
                end
            end
        end
    end
end

local function updateKeyESP()
    if not keyEspEnabled then return end
    
    -- Cari Key dengan multiple detection methods
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("Model") then
            -- Method 1: Direct Key model
            if obj.Name == "KeyObtain" or obj.Name == "Key" or obj.Name:find("Key") then
                local keyPart = obj:FindFirstChild("Handle") or obj:FindFirstChildWhichIsA("BasePart")
                if keyPart and not keyPart:FindFirstChild("WenerESP_key") then
                    createFixedESP(keyPart, "üóùÔ∏è Key", Color3.fromRGB(255, 255, 0), "key")
                end
            end
        elseif obj:IsA("BasePart") then
            -- Method 2: Direct key part
            if obj.Name == "Key" or obj.Name:find("Key") then
                if not obj:FindFirstChild("WenerESP_key") then
                    createFixedESP(obj, "üóùÔ∏è Key", Color3.fromRGB(255, 255, 0), "key")
                end
            end
        end
    end
    
    -- Method 3: Check dalam CurrentRooms untuk keys
    local currentRooms = workspace:FindFirstChild("CurrentRooms")
    if currentRooms then
        for _, room in pairs(currentRooms:GetChildren()) do
            if room:IsA("Model") then
                for _, asset in pairs(room:GetDescendants()) do
                    if asset:IsA("Model") and (asset.Name == "KeyObtain" or asset.Name == "Key") then
                        local keyPart = asset:FindFirstChild("Handle") or asset:FindFirstChildWhichIsA("BasePart")
                        if keyPart and not keyPart:FindFirstChild("WenerESP_key") then
                            createFixedESP(keyPart, "üóùÔ∏è Key", Color3.fromRGB(255, 255, 0), "key")
                        end
                    end
                end
            end
        end
    end
end

local function updateItemESP()
    if not itemEspEnabled then return end
    
    -- List item yang bisa diambil (collectable items)
    local collectableItems = {
        "Vitamins", "Lockpick", "Candle", "Lighter", "FlashlightPickup", "Flashlight",
        "Crucifix", "Bandage", "SkeletonKey", "Shakelight", "Scanner", 
        "Battery", "Herb", "Pill"
    }
    
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("Model") then
            for _, itemName in pairs(collectableItems) do
                if obj.Name == itemName or obj.Name:find(itemName) then
                    -- Cek apakah item ini bisa diambil (ada ProximityPrompt)
                    local hasPrompt = false
                    local itemPart = obj:FindFirstChildWhichIsA("BasePart")
                    
                    if itemPart then
                        local prompt = itemPart:FindFirstChildOfClass("ProximityPrompt")
                        if prompt then hasPrompt = true end
                        
                        -- Jika tidak ada prompt di main part, cek di children
                        if not hasPrompt then
                            for _, child in pairs(obj:GetDescendants()) do
                                if child:IsA("ProximityPrompt") then
                                    hasPrompt = true
                                    break
                                end
                            end
                        end
                        
                        -- Hanya buat ESP jika item bisa diambil dan belum ada ESP
                        if hasPrompt and not itemPart:FindFirstChild("WenerESP_item") then
                            local icon = "üì¶"
                            if itemName == "Vitamins" or itemName == "Pill" then icon = "üíä"
                            elseif itemName == "Lockpick" then icon = "üîì"
                            elseif itemName:find("Flashlight") or itemName == "Shakelight" then icon = "üî¶"
                            elseif itemName == "Candle" then icon = "üïØÔ∏è"
                            elseif itemName == "Lighter" then icon = "üî•"
                            elseif itemName == "Crucifix" then icon = "‚úùÔ∏è"
                            elseif itemName == "Bandage" then icon = "ü©π"
                            elseif itemName == "SkeletonKey" then icon = "üóùÔ∏è"
                            elseif itemName == "Battery" then icon = "üîã"
                            end
                            
                            createFixedESP(itemPart, icon .. " " .. itemName, Color3.fromRGB(255, 0, 0), "item")
                        end
                    end
                    break
                end
            end
        end
    end
end

local function updateBookESP()
    if not bookEspEnabled then return end
    
    -- Cari Figure Books (yang benar untuk Figure sequence)
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("Model") then
            -- Method 1: Book models dalam library/rooms
            if obj.Name == "Book" or obj.Name:find("Book") then
                local bookPart = obj:FindFirstChildWhichIsA("BasePart")
                if bookPart then
                    -- Cek apakah ini book yang bisa di-interact untuk Figure
                    local hasPrompt = bookPart:FindFirstChildOfClass("ProximityPrompt")
                    if hasPrompt and not bookPart:FindFirstChild("WenerESP_book") then
                        createFixedESP(bookPart, "üìö Figure Book", Color3.fromRGB(139, 69, 19), "book")
                    end
                end
            end
        elseif obj:IsA("BasePart") then
            -- Method 2: Direct book parts
            if obj.Name == "Book" or obj.Name:find("Book") then
                local hasPrompt = obj:FindFirstChildOfClass("ProximityPrompt")
                if hasPrompt and not obj:FindFirstChild("WenerESP_book") then
                    createFixedESP(obj, "üìö Figure Book", Color3.fromRGB(139, 69, 19), "book")
                end
            end
        end
    end
    
    -- Method 3: Check in specific room 50 (Library) for books
    local currentRooms = workspace:FindFirstChild("CurrentRooms")
    if currentRooms then
        local room50 = currentRooms:FindFirstChild("50")
        if room50 then
            for _, asset in pairs(room50:GetDescendants()) do
                if asset:IsA("Model") and (asset.Name == "Book" or asset.Name:find("Book")) then
                    local bookPart = asset:FindFirstChildWhichIsA("BasePart")
                    if bookPart then
                        local hasPrompt = bookPart:FindFirstChildOfClass("ProximityPrompt")
                        if hasPrompt and not bookPart:FindFirstChild("WenerESP_book") then
                            createFixedESP(bookPart, "üìö Figure Book", Color3.fromRGB(139, 69, 19), "book")
                        end
                    end
                end
            end
        end
    end
end

local function updateEntityESP()
    if not entityEspEnabled then return end
    
    local entities = {
        {name = "RushMoving", display = "Rush", color = Color3.fromRGB(255, 0, 0)},
        {name = "AmbushMoving", display = "Ambush", color = Color3.fromRGB(255, 100, 0)},
        {name = "Eyes", display = "Eyes", color = Color3.fromRGB(255, 255, 255)},
        {name = "Screech", display = "Screech", color = Color3.fromRGB(0, 255, 0)},
        {name = "Halt", display = "Halt", color = Color3.fromRGB(0, 0, 255)},
        {name = "Seek", display = "Seek", color = Color3.fromRGB(0, 0, 0)},
        {name = "Figure", display = "Figure", color = Color3.fromRGB(139, 0, 255)},
        {name = "Dupe", display = "Dupe", color = Color3.fromRGB(255, 255, 0)},
        {name = "A60", display = "A-60", color = Color3.fromRGB(255, 0, 255)},
        {name = "A120", display = "A-120", color = Color3.fromRGB(0, 255, 255)}
    }
    
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("Model") then
            for _, entityData in pairs(entities) do
                if obj.Name == entityData.name or obj.Name:find(entityData.name) then
                    local entityPart = obj:FindFirstChildWhichIsA("BasePart")
                    if entityPart and not entityPart:FindFirstChild("WenerESP_entity") then
                        createFixedESP(entityPart, "üëπ " .. entityData.display, entityData.color, "entity")
                    end
                    break
                end
            end
        end
    end
end

local function updatePlayerESP()
    if not playerEspEnabled then return end
    
    for _, otherPlayer in pairs(Players:GetPlayers()) do
        if otherPlayer ~= player and otherPlayer.Character then
            local humanoidRootPart = otherPlayer.Character:FindFirstChild("HumanoidRootPart")
            if humanoidRootPart and not humanoidRootPart:FindFirstChild("WenerESP_player") then
                createFixedESP(humanoidRootPart, "üë§ " .. otherPlayer.DisplayName, Color3.fromRGB(0, 255, 255), "player")
            end
        end
    end
end

local function clearAllESP()
    for _, esp in pairs(espObjects) do
        if esp and esp.highlight then esp.highlight:Destroy() end
        if esp and esp.billboard then esp.billboard:Destroy() end
    end
    espObjects = {}
    
    -- Clean up any remaining ESP objects
    for _, obj in pairs(workspace:GetDescendants()) do
        local highlight = obj:FindFirstChild("WenerESP_door") or obj:FindFirstChild("WenerESP_key") or 
                         obj:FindFirstChild("WenerESP_item") or obj:FindFirstChild("WenerESP_book") or
                         obj:FindFirstChild("WenerESP_entity") or obj:FindFirstChild("WenerESP_player")
        if highlight then highlight:Destroy() end
        
        local billboard = obj:FindFirstChild("WenerESP_door_Bill") or obj:FindFirstChild("WenerESP_key_Bill") or
                         obj:FindFirstChild("WenerESP_item_Bill") or obj:FindFirstChild("WenerESP_book_Bill") or
                         obj:FindFirstChild("WenerESP_entity_Bill") or obj:FindFirstChild("WenerESP_player_Bill")
       if billboard then billboard:Destroy() end
    end
end

-- ============================================================================
-- ADVANCED NOTIFICATION SYSTEM
-- ============================================================================

local function createAdvancedNotification(title, message, color, duration, sound)
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "WenerNotification"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = game.CoreGui
    
    local NotificationFrame = Instance.new("Frame")
    NotificationFrame.Size = UDim2.new(0, 400, 0, 120)
    NotificationFrame.Position = UDim2.new(1, 20, 0, 100)
    NotificationFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 25)
    NotificationFrame.BorderSizePixel = 0
    NotificationFrame.Parent = ScreenGui
    
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 15)
    Corner.Parent = NotificationFrame
    
    local Gradient = Instance.new("UIGradient")
    Gradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, color),
        ColorSequenceKeypoint.new(1, Color3.new(color.R * 0.5, color.G * 0.5, color.B * 0.5))
    })
    Gradient.Rotation = 45
    Gradient.Parent = NotificationFrame
    
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Size = UDim2.new(1, -20, 0, 40)
    TitleLabel.Position = UDim2.new(0, 10, 0, 10)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = title
    TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextSize = 20
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.Parent = NotificationFrame
    
    local MessageLabel = Instance.new("TextLabel")
    MessageLabel.Size = UDim2.new(1, -20, 0, 60)
    MessageLabel.Position = UDim2.new(0, 10, 0, 50)
    MessageLabel.BackgroundTransparency = 1
    MessageLabel.Text = message
    MessageLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    MessageLabel.Font = Enum.Font.Gotham
    MessageLabel.TextSize = 16
    MessageLabel.TextWrapped = true
    MessageLabel.TextXAlignment = Enum.TextXAlignment.Left
    MessageLabel.TextYAlignment = Enum.TextYAlignment.Top
    MessageLabel.Parent = NotificationFrame
    
    if sound then
        local soundEffect = Instance.new("Sound")
        soundEffect.SoundId = "rbxassetid://131961136"
        soundEffect.Volume = 0.5
        soundEffect.Parent = ScreenGui
        soundEffect:Play()
        
        soundEffect.Ended:Connect(function()
            soundEffect:Destroy()
        end)
    end
    
    TweenService:Create(NotificationFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back), {
        Position = UDim2.new(1, -420, 0, 100)
    }):Play()
    
    task.spawn(function()
        task.wait(duration or 5)
        
        TweenService:Create(NotificationFrame, TweenInfo.new(0.5, Enum.EasingStyle.Quad), {
            Position = UDim2.new(1, 20, 0, 100),
            BackgroundTransparency = 1
        }):Play()
        
        TweenService:Create(TitleLabel, TweenInfo.new(0.5), {TextTransparency = 1}):Play()
        TweenService:Create(MessageLabel, TweenInfo.new(0.5), {TextTransparency = 1}):Play()
        
        task.wait(0.5)
        ScreenGui:Destroy()
    end)
end

-- ============================================================================
-- ENTITY DETECTION & NOTIFICATION SYSTEM
-- ============================================================================

local lastEntityNotification = {}

local function setupEntityNotifications()
    for _, conn in pairs(entityConnections) do
        pcall(function() conn:Disconnect() end)
    end
    entityConnections = {}
    
    if not rushNotifEnabled and not allEntityNotifications then return end
    
    local entities = {
        {name = "RushMoving", displayName = "Rush", color = Color3.fromRGB(255, 0, 0), message = "Rush is coming! Hide immediately!"},
        {name = "AmbushMoving", displayName = "Ambush", color = Color3.fromRGB(255, 100, 0), message = "Ambush detected! Get ready to hide multiple times!"},
        {name = "Eyes", displayName = "Eyes", color = Color3.fromRGB(255, 255, 255), message = "Eyes appeared! Don't look at them!"},
        {name = "Screech", displayName = "Screech", color = Color3.fromRGB(0, 255, 0), message = "Screech is near! Turn around when you hear the sound!"},
        {name = "Halt", displayName = "Halt", color = Color3.fromRGB(0, 0, 255), message = "Halt appeared! Stop moving when the screen turns blue!"},
        {name = "Seek", displayName = "Seek", color = Color3.fromRGB(0, 0, 0), message = "Seek chase sequence! Run and avoid obstacles!"},
        {name = "Figure", displayName = "Figure", color = Color3.fromRGB(139, 0, 255), message = "Figure is in the library! Move quietly and avoid making noise!"},
        {name = "Dupe", displayName = "Dupe", color = Color3.fromRGB(255, 255, 0), message = "Dupe detected! Check door numbers carefully!"},
        {name = "A60", displayName = "A-60", color = Color3.fromRGB(255, 0, 255), message = "A-60 is coming! Hide in a locker immediately!"},
        {name = "A120", displayName = "A-120", color = Color3.fromRGB(0, 255, 255), message = "A-120 detected! Find a hiding spot quickly!"}
    }
    
    local function onEntityAdded(entity)
        for _, entityData in pairs(entities) do
            if entity.Name == entityData.name or entity.Name:find(entityData.name) then
                local currentTime = tick()
                
                if lastEntityNotification[entityData.name] and currentTime - lastEntityNotification[entityData.name] < 3 then
                    return
                end
                lastEntityNotification[entityData.name] = currentTime
                
                local shouldNotify = false
                if allEntityNotifications then
                    shouldNotify = true
                elseif rushNotifEnabled and (entityData.name == "RushMoving" or entityData.name == "AmbushMoving") then
                    shouldNotify = true
                end
                
                if shouldNotify then
                    createAdvancedNotification(
                        "‚ö†Ô∏è ENTITY DETECTED: " .. entityData.displayName,
                        entityData.message,
                        entityData.color,
                        6,
                        true
                    )
                    
                    print("üö® Entity Alert: " .. entityData.displayName .. " detected!")
                end
                break
            end
        end
    end
    
    local conn = workspace.DescendantAdded:Connect(function(descendant)
        if descendant:IsA("Model") then
            task.wait(0.1)
            onEntityAdded(descendant)
        end
    end)
    
    table.insert(entityConnections, conn)
end

-- ============================================================================
-- AUTO COLLECT SYSTEM
-- ============================================================================

local autoCollectSettings = {
    ["Vitamins"] = true,
    ["Lockpick"] = true,
    ["Key"] = true,
    ["Flashlight"] = true,
    ["Lighter"] = true,
    ["Candle"] = true,
    ["Crucifix"] = true,
    ["Bandage"] = true,
    ["SkeletonKey"] = true,
    ["Book"] = true
}

local function enableAutoCollect()
    autoCollectEnabled = true
    
    if autoCollectConnection then autoCollectConnection:Disconnect() end
    
    local function collectItems()
        if not autoCollectEnabled or not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end
        
        for _, obj in pairs(workspace:GetDescendants()) do
            if obj:IsA("Model") then
                local shouldCollect = false
                
                for itemName, enabled in pairs(autoCollectSettings) do
                    if enabled and (obj.Name == itemName or obj.Name:find(itemName)) then
                        shouldCollect = true
                        break
                    end
                end
                
                if shouldCollect then
                    local itemPart = obj:FindFirstChildWhichIsA("BasePart")
                    if itemPart then
                        local distance = (player.Character.HumanoidRootPart.Position - itemPart.Position).Magnitude
                        if distance <= 15 then
                            local prompt = itemPart:FindFirstChildOfClass("ProximityPrompt")
                            if prompt and prompt.Enabled then
                                pcall(function()
                                    fireproximityprompt(prompt)
                                end)
                            end
                        end
                    end
                end
            end
        end
    end
    
    autoCollectConnection = RunService.Heartbeat:Connect(function()
        collectItems()
    end)
    
    print("üì¶ Advanced Auto Collect: ENABLED")
end

local function disableAutoCollect()
    autoCollectEnabled = false
    
    if autoCollectConnection then autoCollectConnection:Disconnect() end
    
    print("üì¶ Advanced Auto Collect: DISABLED")
end

-- ============================================================================
-- AUTO UNLOCK SYSTEM
-- ============================================================================

local function enableAutoUnlock()
    autoUnlockEnabled = true
    
    if autoUnlockConnection then autoUnlockConnection:Disconnect() end
    
    local function unlockDoors()
        if not autoUnlockEnabled or not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end
        
        local currentRooms = workspace:FindFirstChild("CurrentRooms")
        if not currentRooms then return end
        
        for _, room in pairs(currentRooms:GetChildren()) do
            if room:IsA("Model") and tonumber(room.Name) then
                local door = room:FindFirstChild("Door")
                if door then
                    local lockPart = door:FindFirstChild("Lock")
                    if lockPart then
                        local prompt = lockPart:FindFirstChildOfClass("ProximityPrompt")
                        if prompt and prompt.Enabled then
                            local distance = (player.Character.HumanoidRootPart.Position - lockPart.Position).Magnitude
                            if distance <= 15 then
                                pcall(function()
                                    fireproximityprompt(prompt)
                                end)
                            end
                        end
                    end
                end
            end
        end
    end
    
    autoUnlockConnection = RunService.Heartbeat:Connect(function()
        unlockDoors()
    end)
    
    print("üîì Advanced Auto Unlock: ENABLED")
end

local function disableAutoUnlock()
    autoUnlockEnabled = false
    
    if autoUnlockConnection then autoUnlockConnection:Disconnect() end
    
    print("üîì Advanced Auto Unlock: DISABLED")
end

-- ============================================================================
-- INFINITE VITAMINS SYSTEM
-- ============================================================================

local function enableInfVitamins()
    infVitaminsEnabled = true
    
    if infVitaminsConnection then infVitaminsConnection:Disconnect() end
    
    local function maintainVitamins()
        if not infVitaminsEnabled or not player.Character then return end
        
        local humanoid = player.Character:FindFirstChild("Humanoid")
        if not humanoid then return end
        
        for _, effect in pairs(humanoid:GetChildren()) do
            if effect:IsA("NumberValue") and effect.Name == "Vitamins" then
                effect.Value = math.huge
            end
        end
        
        if humanoid.Health < humanoid.MaxHealth * 0.8 then
            for _, item in pairs(player.Backpack:GetChildren()) do
                if item.Name == "Vitamins" and item:IsA("Tool") then
                    humanoid:EquipTool(item)
                    task.wait(0.5)
                    if item:FindFirstChild("Handle") then
                        local prompt = item.Handle:FindFirstChildOfClass("ProximityPrompt")
                        if prompt then
                            fireproximityprompt(prompt)
                        end
                    end
                    break
                end
            end
        end
    end
    
    infVitaminsConnection = RunService.Heartbeat:Connect(function()
        maintainVitamins()
    end)
    
    print("üíä Infinite Vitamins: ENABLED")
end

local function disableInfVitamins()
    infVitaminsEnabled = false
    
    if infVitaminsConnection then infVitaminsConnection:Disconnect() end
    
    print("üíä Infinite Vitamins: DISABLED")
end

-- ============================================================================
-- MAIN FUNCTIONS
-- ============================================================================

local function setSpeed(speed)
    currentSpeed = speed
    if player.Character and player.Character:FindFirstChild("Humanoid") then
        player.Character.Humanoid.WalkSpeed = speed
    end
end

local function enableGodMode()
    godModeEnabled = true
    
    for _, conn in pairs(godModeConnections) do
        pcall(function() conn:Disconnect() end)
    end
    godModeConnections = {}
    
    local function maintainGodMode()
        if not godModeEnabled or not player.Character then return end
        
        local humanoid = player.Character:FindFirstChild("Humanoid")
        if humanoid then
            humanoid.MaxHealth = math.huge
            humanoid.Health = math.huge
            
            for _, child in pairs(player.Character:GetChildren()) do
                if child:IsA("BasePart") then
                    child:SetAttribute("OriginalCanTouch", child.CanTouch)
                    child.CanTouch = false
                end
            end
        end
    end
    
    local conn1 = RunService.Heartbeat:Connect(maintainGodMode)
    table.insert(godModeConnections, conn1)
    
    print("üõ°Ô∏è Advanced God Mode: ENABLED")
end

local function disableGodMode()
    godModeEnabled = false
    
    for _, conn in pairs(godModeConnections) do
        pcall(function() conn:Disconnect() end)
    end
    godModeConnections = {}
    
    if player.Character then
        local humanoid = player.Character:FindFirstChild("Humanoid")
        if humanoid then
            humanoid.MaxHealth = 100
            humanoid.Health = 100
        end
        
        for _, child in pairs(player.Character:GetChildren()) do
            if child:IsA("BasePart") and child:GetAttribute("OriginalCanTouch") ~= nil then
                child.CanTouch = child:GetAttribute("OriginalCanTouch")
            end
        end
    end
    
    print("üõ°Ô∏è Advanced God Mode: DISABLED")
end

local function enableNoclip()
    noclipEnabled = true
    
    if noclipConnection then noclipConnection:Disconnect() end
    
    noclipConnection = RunService.Stepped:Connect(function()
        if noclipEnabled and player.Character then
            for _, part in pairs(player.Character:GetDescendants()) do
                if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                    part.CanCollide = false
                end
            end
        end
    end)
    
    print("üëª Advanced Noclip: ENABLED")
end

local function disableNoclip()
    noclipEnabled = false
    
    if noclipConnection then noclipConnection:Disconnect() end
    
    if player.Character then
        for _, part in pairs(player.Character:GetDescendants()) do
            if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                part.CanCollide = true
            end
        end
    end
    
    print("üëª Advanced Noclip: DISABLED")
end

local function enableBypassAntiCheat()
    bypassAntiCheat = true
    
    for _, conn in pairs(bypassConnections) do
        pcall(function() conn:Disconnect() end)
    end
    bypassConnections = {}
    
    local mt = getrawmetatable(game)
    local oldNamecall = mt.__namecall
    
    setreadonly(mt, false)
    mt.__namecall = function(self, ...)
        local method = getnamecallmethod()
        local args = {...}
        
        if method == "FireServer" or method == "InvokeServer" then
            local remoteName = tostring(self)
            if remoteName:find("Anti") or remoteName:find("Kick") or remoteName:find("Ban") then
                return
            end
        end
        
        return oldNamecall(self, ...)
    end
    setreadonly(mt, true)
    
    print("üõ°Ô∏è Bypass Anti-Cheat: ENABLED")
end

local function disableBypassAntiCheat()
    bypassAntiCheat = false
    
    for _, conn in pairs(bypassConnections) do
        pcall(function() conn:Disconnect() end)
    end
    bypassConnections = {}
    
    print("üõ°Ô∏è Bypass Anti-Cheat: DISABLED")
end

-- Apply settings on character spawn
player.CharacterAdded:Connect(function(character)
    wait(1)
    if character:FindFirstChild("Humanoid") then
        character.Humanoid.WalkSpeed = currentSpeed
        if godModeEnabled then
            enableGodMode()
        end
        if noclipEnabled then
            enableNoclip()
        end
    end
end)

-- ============================================================================
-- RAYFIELD UI
-- ============================================================================

task.spawn(function()
    wait(14) -- Wait for all screens
    
    local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
    
    local Window = Rayfield:CreateWindow({
        Name = "Wener Hub v4.0 - Ultimate Complete Edition [FIXED ESP]",
        LoadingTitle = "Wener Hub Ultimate Complete",
        LoadingSubtitle = "Fixed ESP System & All Advanced Features",
        ConfigurationSaving = {
            Enabled = true,
            FolderName = "WenerHub",
            FileName = "Config"
        },
        Discord = {
            Enabled = false
        },
        KeySystem = false
    })
    
    -- Create Tabs
    local InfoTab = Window:CreateTab("üìã Info", 4483362458)
    local MainTab = Window:CreateTab("‚öôÔ∏è Main Features", 4483362458)
    local ESPTab = Window:CreateTab("üëÅÔ∏è Fixed ESP", 4483362458)
    local AutoTab = Window:CreateTab("ü§ñ Automation", 4483362458)
    local NotifTab = Window:CreateTab("üîî Notifications", 4483362458)
    local MiscTab = Window:CreateTab("üîß Miscellaneous", 4483362458)
    
    -- Info Tab
    InfoTab:CreateParagraph({
        Title = "üë§ Player Information", 
        Content = "Username: " .. player.Name .. 
                  "\nDisplay Name: " .. player.DisplayName .. 
                  "\nUser ID: " .. player.UserId ..
                  (isOwner and "\n\nüëë OWNER ACCESS GRANTED" or "")
    })
    
    InfoTab:CreateParagraph({
        Title = "üöÄ WENER Hub v4.0 Ultimate - FIXED ESP", 
        Content = "‚úÖ Fixed ESP Size - Billboard size tetap saat zoom\n‚úÖ Fixed Key ESP - Deteksi key yang benar\n‚úÖ Fixed Item ESP - Hanya item yang bisa diambil\n‚úÖ Fixed Book ESP - Hanya Figure books\n‚úÖ Bright Outline - Terang dengan warna:\n   ‚Ä¢ Doors: Hijau üü¢\n   ‚Ä¢ Items: Merah üî¥\n   ‚Ä¢ Keys: Kuning üü°\n   ‚Ä¢ Books: Coklat üü§"
    })
    
    InfoTab:CreateParagraph({
        Title = "üîë Key System Info", 
        Content = "‚Ä¢ Key expires every 2 hours\n‚Ä¢ Valid key: Wene-you\n‚Ä¢ Owner bypass available\n‚Ä¢ Automatic key verification\n‚Ä¢ Settings auto-save enabled"
    })
    
    -- Main Features Tab
    MainTab:CreateSlider({
        Name = "‚ö° Speed Multiplier",
        Range = {1, 6},
        Increment = 0.1,
        Suffix = "x",
        CurrentValue = 1,
        Flag = "SpeedSlider",
        Callback = function(v) 
            setSpeed(16 * v)
        end
    })
    
    MainTab:CreateToggle({
        Name = "üõ°Ô∏è Advanced God Mode",
        CurrentValue = false,
        Flag = "GodMode",
        Callback = function(v)
            if v then
                enableGodMode()
            else
                disableGodMode()
            end
        end
    })
    
    MainTab:CreateToggle({
        Name = "üîì Bypass Anti-Cheat",
        CurrentValue = false,
        Flag = "BypassAntiCheat",
        Callback = function(v)
            if v then
                enableBypassAntiCheat()
            else
                disableBypassAntiCheat()
            end
        end
    })
    
    MainTab:CreateToggle({
        Name = "üëª Advanced Noclip",
        CurrentValue = false,
        Flag = "Noclip",
        Callback = function(v)
            if v then
                enableNoclip()
            else
                disableNoclip()
            end
        end
    })
    
    MainTab:CreateButton({
        Name = "üîÑ Respawn Character",
        Callback = function()
            if player.Character then
                player.Character:BreakJoints()
            end
        end
    })
    
    MainTab:CreateButton({
        Name = "üö™ Teleport to Latest Room",
        Callback = function()
            local currentRooms = workspace:FindFirstChild("CurrentRooms")
            if currentRooms and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local latestRoom = nil
                local highestNumber = 0
                
                for _, room in pairs(currentRooms:GetChildren()) do
                    local roomNumber = tonumber(room.Name)
                    if roomNumber and roomNumber > highestNumber then
                        highestNumber = roomNumber
                        latestRoom = room
                    end
                end
                
                if latestRoom then
                    local roomPos = latestRoom:FindFirstChildWhichIsA("BasePart")
                    if roomPos then
                        player.Character.HumanoidRootPart.CFrame = CFrame.new(roomPos.Position + Vector3.new(0, 5, 0))
                    end
                end
            end
        end
    })
    
    -- Fixed ESP Features Tab
    ESPTab:CreateLabel("‚ú® FIXED ESP SYSTEM - Size tetap, outline terang!")
    
    ESPTab:CreateToggle({
        Name = "üö™ Door ESP (Green Outline)",
        CurrentValue = false,
        Flag = "DoorESP",
        Callback = function(v)
            doorEspEnabled = v
            if not v then 
                clearAllESP() 
            else
                updateDoorESP()
            end
        end
    })
    
    ESPTab:CreateToggle({
        Name = "üóùÔ∏è Key ESP (Yellow Outline) - FIXED",
        CurrentValue = false,
        Flag = "KeyESP",
        Callback = function(v)
            keyEspEnabled = v
            if not v then 
                clearAllESP() 
            else
                updateKeyESP()
            end
        end
    })
    
    ESPTab:CreateToggle({
        Name = "üì¶ Item ESP (Red Outline) - Collectable Only",
        CurrentValue = false,
        Flag = "ItemESP",
        Callback = function(v)
            itemEspEnabled = v
            if not v then 
                clearAllESP() 
            else
                updateItemESP()
            end
        end
    })
    
    ESPTab:CreateToggle({
        Name = "üìö Book ESP (Brown Outline) - Figure Books",
        CurrentValue = false,
        Flag = "BookESP",
        Callback = function(v)
            bookEspEnabled = v
            if not v then 
                clearAllESP() 
            else
                updateBookESP()
            end
        end
    })
    
    ESPTab:CreateToggle({
        Name = "üëπ Entity ESP (All Monsters)",
        CurrentValue = false,
        Flag = "EntityESP",
        Callback = function(v)
            entityEspEnabled = v
            if not v then 
                clearAllESP() 
            else
                updateEntityESP()
            end
        end
    })
    
    ESPTab:CreateToggle({
        Name = "üë§ Player ESP",
        CurrentValue = false,
        Flag = "PlayerESP",
        Callback = function(v)
            playerEspEnabled = v
            if not v then 
                clearAllESP() 
            else
                updatePlayerESP()
            end
        end
    })
    
    ESPTab:CreateButton({
        Name = "üîÑ Refresh All ESP",
        Callback = function()
            clearAllESP()
            if doorEspEnabled then updateDoorESP() end
            if keyEspEnabled then updateKeyESP() end
            if itemEspEnabled then updateItemESP() end
            if bookEspEnabled then updateBookESP() end
            if entityEspEnabled then updateEntityESP() end
            if playerEspEnabled then updatePlayerESP() end
        end
    })
    
    ESPTab:CreateButton({
        Name = "üóëÔ∏è Clear All ESP",
        Callback = function()
            doorEspEnabled = false
            keyEspEnabled = false
            entityEspEnabled = false
            playerEspEnabled = false
            bookEspEnabled = false
            itemEspEnabled = false
            clearAllESP()
        end
    })
    
    ESPTab:CreateParagraph({
        Title = "üéØ ESP Features", 
        Content = "‚úÖ Billboard size tetap saat zoom in/out\n‚úÖ Bright outline dengan warna berbeda\n‚úÖ Distance indicator real-time\n‚úÖ Auto remove ESP objek jauh\n‚úÖ Smart detection algorithms\n‚úÖ Performance optimized"
    })
    
    -- Automation Tab
    AutoTab:CreateToggle({
        Name = "üì¶ Smart Auto Collect Items",
        CurrentValue = false,
        Flag = "AutoCollect",
        Callback = function(v)
            if v then
                enableAutoCollect()
            else
                disableAutoCollect()
            end
        end
    })
    
    AutoTab:CreateToggle({
        Name = "üîì Auto Unlock Doors",
        CurrentValue = false,
        Flag = "AutoUnlock",
        Callback = function(v)
            if v then
                enableAutoUnlock()
            else
                disableAutoUnlock()
            end
        end
    })
    
    AutoTab:CreateToggle({
        Name = "üíä Infinite Vitamins Effect",
        CurrentValue = false,
        Flag = "InfVitamins",
        Callback = function(v)
            if v then
                enableInfVitamins()
            else
                disableInfVitamins()
            end
        end
    })
    
    AutoTab:CreateSection("Auto Collect Settings")
    
    for itemName, _ in pairs(autoCollectSettings) do
        AutoTab:CreateToggle({
            Name = "Collect " .. itemName,
            CurrentValue = true,
            Flag = "Collect" .. itemName,
            Callback = function(v)
                autoCollectSettings[itemName] = v
            end
        })
    end
    
    -- Notifications Tab
    NotifTab:CreateToggle({
        Name = "üö® Rush/Ambush Notifications",
        CurrentValue = false,
        Flag = "RushNotif",
        Callback = function(v)
            rushNotifEnabled = v
            setupEntityNotifications()
        end
    })
    
    NotifTab:CreateToggle({
        Name = "üëπ All Entity Notifications",
        CurrentValue = false,
        Flag = "AllEntityNotif",
        Callback = function(v)
            allEntityNotifications = v
            setupEntityNotifications()
        end
    })
    
    NotifTab:CreateButton({
        Name = "üß™ Test Notification System",
        Callback = function()
            createAdvancedNotification(
                "üß™ Test Notification",
                "This is a test of the advanced notification system with sound effects!",
                Color3.fromRGB(0, 255, 0),
                3,
                true
            )
        end
    })
    
    NotifTab:CreateParagraph({
        Title = "üìã Notification Features", 
        Content = "‚Ä¢ Advanced visual effects with gradients\n‚Ä¢ Sound notifications for important events\n‚Ä¢ Smart spam prevention\n‚Ä¢ Customizable duration and colors\n‚Ä¢ Slide-in animations"
    })
    
    -- Miscellaneous Tab
    MiscTab:CreateButton({
        Name = "üíæ Save Current Settings",
        Callback = function()
            local settings = {
                speed = currentSpeed,
                godMode = godModeEnabled,
                noclip = noclipEnabled,
                bypassAntiCheat = bypassAntiCheat,
                doorESP = doorEspEnabled,
                keyESP = keyEspEnabled,
                entityESP = entityEspEnabled,
                playerESP = playerEspEnabled,
                bookESP = bookEspEnabled,
                itemESP = itemEspEnabled,
                autoCollect = autoCollectEnabled,
                autoUnlock = autoUnlockEnabled,
                infVitamins = infVitaminsEnabled,
                rushNotif = rushNotifEnabled,
                allEntityNotif = allEntityNotifications,
                autoCollectSettings = autoCollectSettings
            }
            
            writefile("WenerHub/Settings.json", game:GetService("HttpService"):JSONEncode(settings))
            
            createAdvancedNotification(
                "üíæ Settings Saved",
                "All current settings have been saved successfully!",
                Color3.fromRGB(0, 255, 0),
                3,
                false
            )
        end
    })
    
    MiscTab:CreateButton({
        Name = "üìÇ Load Saved Settings",
        Callback = function()
            local success, settings = pcall(function()
                return game:GetService("HttpService"):JSONDecode(readfile("WenerHub/Settings.json"))
            end)
            
            if success and settings then
                if settings.speed then setSpeed(settings.speed) end
                if settings.godMode then 
                    if settings.godMode then enableGodMode() else disableGodMode() end
                end
                if settings.noclip then
                    if settings.noclip then enableNoclip() else disableNoclip() end
                end
                
                createAdvancedNotification(
                    "üìÇ Settings Loaded",
                    "Saved settings have been loaded and applied successfully!",
                    Color3.fromRGB(0, 255, 0),
                    3,
                    false
                )
            else
                createAdvancedNotification(
                    "‚ùå Load Failed",
                    "No saved settings found or file is corrupted.",
                    Color3.fromRGB(255, 0, 0),
                    3,
                    false
                )
            end
        end
    })
    
    MiscTab:CreateButton({
        Name = "üîÑ Reconnect to Server",
        Callback = function()
            TeleportService:Teleport(game.PlaceId, player)
        end
    })
    
    MiscTab:CreateButton({
        Name = "üìã Copy Discord Link",
        Callback = function()
            setclipboard("https://discord.gg/wanerhub")
            createAdvancedNotification(
                "üìã Copied!",
                "Discord link has been copied to clipboard!",
                Color3.fromRGB(0, 255, 255),
                3,
                false
            )
        end
    })
    
    MiscTab:CreateParagraph({
        Title = "üîß System Information", 
        Content = "‚Ä¢ Auto Execute: ‚úÖ CONFIGURED\n‚Ä¢ Auto Reconnect: ‚úÖ ACTIVE\n‚Ä¢ Fixed ESP: ‚úÖ OPERATIONAL\n‚Ä¢ Performance: ‚úÖ OPTIMIZED\n‚Ä¢ Memory Usage: ‚úÖ MINIMAL"
    })
    
    -- Final notification
    Rayfield:Notify({
        Title = "üöÄ WENER HUB v4.0 LOADED - ESP FIXED!",
        Content = "Welcome " .. player.DisplayName .. "!\nAll systems operational with FIXED ESP!",
        Duration = 5,
        Image = 4483362458,
    })
    
    print("‚úÖ WENER HUB v4.0 ULTIMATE WITH FIXED ESP LOADED!")
    print("üöÄ All systems operational and ready to use!")
    print("üëÅÔ∏è ESP System: FIXED - Size tetap, outline terang!")
    print("üëë Owner Status: " .. (isOwner and "ACTIVE" or "INACTIVE"))
    print("üîë Key System: 2-HOUR EXPIRY ACTIVE")
    print("üì° Auto Reconnect: ACTIVE")
    print("üöÄ Auto Execute: CONFIGURED")
end)

-- Auto refresh ESP every 10 seconds
task.spawn(function()
    while true do
        wait(10)
        if doorEspEnabled or keyEspEnabled or entityEspEnabled or playerEspEnabled or bookEspEnabled or itemEspEnabled then
            clearAllESP()
            if doorEspEnabled then updateDoorESP() end
            if keyEspEnabled then updateKeyESP() end
            if itemEspEnabled then updateItemESP() end
            if bookEspEnabled then updateBookESP() end
            if entityEspEnabled then updateEntityESP() end
            if playerEspEnabled then updatePlayerESP() end
        end
    end
end)

print("‚úÖ WENER HUB v4.0 CORE SYSTEMS INITIALIZED!")
print("üéÆ All features integrated and working!")
print("üëÅÔ∏è ESP System: COMPLETELY FIXED!")
print("üîë Key expires every 2 hours - fully functional!")
print("=" .. string.rep("=", 60) .. "=")
print("WENER HUB v4.0 ULTIMATE COMPLETE WITH FIXED ESP")
print("Created by: winnertupiq52")
print("All systems ready and operational! üöÄ")
print("=" .. string.rep("=", 60) .. "=")
