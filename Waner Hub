-- Load Rayfield Library (Working Alternative to Obsidian)
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Key System
local validKeys = {
    ["Wene-you"] = true,
    ["Wene-123"] = true,
    ["Wene-anti"] = true,
    ["Wene-police"] = true
}

local keyExpiry = "KeyExpiry_Doors"
local keyUsed = "KeyUsed_Doors"

local function checkKey()
    local success, savedKey = pcall(function()
        return game:GetService("HttpService"):JSONDecode(readfile(keyExpiry) or '""')
    end)
    local success2, expiry = pcall(function()
        return tonumber(readfile(keyExpiry) or "0")
    end)
    
    if success and success2 and savedKey ~= "" and validKeys[savedKey] and os.time() < expiry then
        return true
    end
    return false
end

local function saveKey(key)
    pcall(function()
        writefile(keyUsed, game:GetService("HttpService"):JSONEncode(key))
        writefile(keyExpiry, tostring(os.time() + 86400)) -- 24 jam
    end)
end

-- Key System Window
if not checkKey() then
    local KeyWindow = Rayfield:CreateWindow({
        Name = "Doors Script - Key System",
        LoadingTitle = "Loading Key System...",
        LoadingSubtitle = "by YourName",
    })
    
    local KeyTab = KeyWindow:CreateTab("ðŸ”‘ Key System", 4483362458)
    
    local KeySection = KeyTab:CreateSection("Enter Key")
    
    local KeyInput = KeySection:CreateInput({
        Name = "Key Input",
        PlaceholderText = "Enter your key here...",
        RemoveTextAfterFocusLost = false,
        Callback = function(Text)
            if validKeys[Text] then
                saveKey(Text)
                Rayfield:Notify({
                    Title = "Key Valid!",
                    Content = "Access granted for 24 hours",
                    Duration = 3,
                    Image = 4483362458,
                })
                KeyWindow:Destroy()
                wait(1)
                loadMainScript()
            else
                Rayfield:Notify({
                    Title = "Invalid Key!",
                    Content = "Please try again",
                    Duration = 3,
                    Image = 4483362458,
                })
            end
        end,
    })
    
    KeySection:CreateLabel("Valid Keys: Wene-you, Wene-123, Wene-anti, Wene-police")
else
    loadMainScript()
end

function loadMainScript()
    -- Main Window
    local Window = Rayfield:CreateWindow({
        Name = "ðŸšª Doors Script",
        LoadingTitle = "Doors Script Loading...",
        LoadingSubtitle = "by YourName",
    })

    -- Variables
    local player = game.Players.LocalPlayer
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoid = character:WaitForChild("Humanoid")

    local autoProximity = false
    local autoLoot = false
    local godMode = false
    local speedEnabled = false
    local noclipEnabled = false
    local espEnabled = false
    local notifyEnabled = true

    local speedValue = 16
    local originalSpeed = humanoid.WalkSpeed

    -- Info Tab
    local InfoTab = Window:CreateTab("â„¹ï¸ Info", 4483362458)
    
    local InfoSection = InfoTab:CreateSection("Player Information")
    
    InfoSection:CreateLabel("ðŸ‘¤ Username: " .. player.Name)
    InfoSection:CreateLabel("ðŸ“ Display Name: " .. player.DisplayName)
    InfoSection:CreateLabel("ðŸ†” User ID: " .. player.UserId)
    
    local expiryTime = tonumber(readfile(keyExpiry) or "0")
    local hoursLeft = math.max(0, math.floor((expiryTime - os.time()) / 3600))
    InfoSection:CreateLabel("â° Key Expires: " .. hoursLeft .. " hours")

    -- Auto Tab
    local AutoTab = Window:CreateTab("ðŸ¤– Auto", 4483362458)
    
    local AutoSection = AutoTab:CreateSection("Auto Features")
    
    local AutoProximityToggle = AutoSection:CreateToggle({
        Name = "ðŸ”„ Auto ProximityPrompt (R)",
        CurrentValue = false,
        Flag = "AutoProximity",
        Callback = function(Value)
            autoProximity = Value
        end,
    })
    
    local AutoLootToggle = AutoSection:CreateToggle({
        Name = "ðŸ“¦ Auto Ambil Barang di Laci",
        CurrentValue = false,
        Flag = "AutoLoot",
        Callback = function(Value)
            autoLoot = Value
        end,
    })

    -- Bypass Tab
    local BypassTab = Window:CreateTab("ðŸ›¡ï¸ Bypass", 4483362458)
    
    local BypassSection = BypassTab:CreateSection("Bypass Features (Anti-Detect)")
    
    local GodModeToggle = BypassSection:CreateToggle({
        Name = "âš¡ God Mode Bypass",
        CurrentValue = false,
        Flag = "GodMode",
        Callback = function(Value)
            godMode = Value
            if godMode then
                humanoid.Health = humanoid.MaxHealth
            end
        end,
    })
    
    local SpeedSlider = BypassSection:CreateSlider({
        Name = "ðŸƒ Speed Bypass",
        Range = {16, 100},
        Increment = 1,
        Suffix = " Speed",
        CurrentValue = 16,
        Flag = "SpeedValue",
        Callback = function(Value)
            speedValue = Value
            if speedEnabled then
                humanoid.WalkSpeed = speedValue
            end
        end,
    })
    
    local SpeedToggle = BypassSection:CreateToggle({
        Name = "âœ… Enable Speed",
        CurrentValue = false,
        Flag = "SpeedEnabled",
        Callback = function(Value)
            speedEnabled = Value
            if speedEnabled then
                humanoid.WalkSpeed = speedValue
            else
                humanoid.WalkSpeed = originalSpeed
            end
        end,
    })
    
    local NoclipToggle = BypassSection:CreateToggle({
        Name = "ðŸ‘» Noclip Bypass",
        CurrentValue = false,
        Flag = "Noclip",
        Callback = function(Value)
            noclipEnabled = Value
        end,
    })

    -- Main Menu Tab
    local MainTab = Window:CreateTab("ðŸŽ® Main Menu", 4483362458)
    
    local MainSection = MainTab:CreateSection("Main Features")
    
    local MainSpeedSlider = MainSection:CreateSlider({
        Name = "ðŸƒ Speed",
        Range = {16, 100},
        Increment = 1,
        Suffix = " Speed",
        CurrentValue = 16,
        Flag = "MainSpeed",
        Callback = function(Value)
            humanoid.WalkSpeed = Value
        end,
    })
    
    local MainGodToggle = MainSection:CreateToggle({
        Name = "âš¡ God Mode",
        CurrentValue = false,
        Flag = "MainGod",
        Callback = function(Value)
            if Value then
                humanoid.Health = humanoid.MaxHealth
            end
        end,
    })
    
    local MainNoclipToggle = MainSection:CreateToggle({
        Name = "ðŸ‘» Noclip",
        CurrentValue = false,
        Flag = "MainNoclip",
        Callback = function(Value)
            noclipEnabled = Value
        end,
    })

    -- ESP Tab
    local ESPTab = Window:CreateTab("ðŸ‘ï¸ ESP", 4483362458)
    
    local ESPSection = ESPTab:CreateSection("ESP Features")
    
    local ESPToggle = ESPSection:CreateToggle({
        Name = "ðŸ” Enable ESP",
        CurrentValue = false,
        Flag = "ESP",
        Callback = function(Value)
            espEnabled = Value
        end,
    })
    
    ESPSection:CreateLabel("ðŸ”µ Key = Blue | ðŸŸ¢ Door = Green")
    ESPSection:CreateLabel("ðŸŸ£ Item = Purple | ðŸŸ  Hide Spot = Orange")

    -- Notify Tab
    local NotifyTab = Window:CreateTab("ðŸ”” Notify", 4483362458)
    
    local NotifySection = NotifyTab:CreateSection("Notification Settings")
    
    local NotifyToggle = NotifySection:CreateToggle({
        Name = "ðŸš¨ Auto Notify Entity",
        CurrentValue = true,
        Flag = "Notify",
        Callback = function(Value)
            notifyEnabled = Value
        end,
    })

    -- Auto Functions
    game:GetService("RunService").RenderStepped:Connect(function()
        if autoProximity then
            for _, v in pairs(workspace:GetDescendants()) do
                if v:IsA("ProximityPrompt") and v.Enabled then
                    pcall(function()
                        fireproximityprompt(v)
                    end)
                end
            end
        end
        
        if autoLoot then
            for _, v in pairs(workspace:GetDescendants()) do
                if v.Name == "DrawerContainer" or v.Name == "Drawer" then
                    local prompt = v:FindFirstChildOfClass("ProximityPrompt")
                    if prompt then
                        pcall(function()
                            fireproximityprompt(prompt)
                        end)
                    end
                end
            end
        end
        
        if noclipEnabled then
            pcall(function()
                for _, part in pairs(character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end)
        end
        
        if godMode then
            pcall(function()
                if humanoid.Health < humanoid.MaxHealth then
                    humanoid.Health = humanoid.MaxHealth
                end
            end)
        end
    end)

    -- ESP Functions
    local function createESP(obj, color)
        if not espEnabled then return end
        
        pcall(function()
            local highlight = Instance.new("Highlight")
            highlight.Parent = obj
            highlight.OutlineColor = color
            highlight.FillTransparency = 1
            highlight.OutlineTransparency = 0
        end)
    end

    workspace.ChildAdded:Connect(function(child)
        if espEnabled then
            pcall(function()
                if child.Name == "Key" then
                    createESP(child, Color3.fromRGB(0, 0, 255)) -- Blue
                elseif child.Name:match("Door") then
                    createESP(child, Color3.fromRGB(0, 255, 0)) -- Green
                elseif child.Name:match("Item") then
                    createESP(child, Color3.fromRGB(128, 0, 128)) -- Purple
                elseif child.Name:match("Closet") or child.Name:match("Wardrobe") then
                    createESP(child, Color3.fromRGB(255, 165, 0)) -- Orange
                end
            end)
        end
    end)

    -- Entity Notifications
    workspace.ChildAdded:Connect(function(child)
        if notifyEnabled then
            local entities = {"Rush", "Ambush", "Eyes", "Screech", "Halt", "Seek", "Figure", "Jack", "Timothy"}
            for _, entity in pairs(entities) do
                if child.Name == entity then
                    Rayfield:Notify({
                        Title = "ðŸš¨ Entity Detected!",
                        Content = entity .. " has spawned!",
                        Duration = 5,
                        Image = 4483362458,
                    })
                end
            end
        end
    end)

    Rayfield:Notify({
        Title = "âœ… Script Loaded!",
        Content = "Doors Script successfully loaded",
        Duration = 3,
        Image = 4483362458,
    })
end
